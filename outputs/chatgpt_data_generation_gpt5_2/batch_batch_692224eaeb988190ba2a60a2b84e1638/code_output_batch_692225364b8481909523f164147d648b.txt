{"id": "batch_req_6922257dae708190a55a96f4fabc27a7", "custom_id": "req-0001", "response": {"status_code": 200, "request_id": "8fb09d8b488537583a784e2bfb8643a0", "body": {"id": "resp_0e49f15aecd4ba44006922253b294481a0b0607c7dd6348af1", "object": "response", "created_at": 1763845435, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0e49f15aecd4ba44006922253b9b9881a0afbe380eb0d352b8", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Standard conflict limit check:\n  if (CONFLICTS < solver->limits.restart.conflicts)\n    return false;\n\n  // Use reluctant trigger in stable mode.\n  if (solver->stable)\n    return kissat_reluctant_triggered (&solver->reluctant);\n\n  // --- Adaptive Glue + Decision Rate Restart (AGDRR) ---\n\n  // 1. Gather stats.\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // 2. Glue ratio.\n  const double glue_ratio = fast_glue / (slow_glue + 1.0);\n\n  // 3. Thresholds.\n  const double glue_threshold = 1.10;\n  const double decision_rate_threshold = 0.95;\n\n  // 4. Historical decision rate: store at stage start.\n  // We use solver->stage_decision_rate as the historical rate\n  // (must be initialized at start of search stage).\n  const double historical_decision_rate = solver->stage_decision_rate;\n\n  // 5. Decision rate ratio.\n  const double dr_ratio =\n    (historical_decision_rate > 0.0) ? (decision_rate / historical_decision_rate) : 1.0;\n\n  // 6. Restart conditions.\n  bool glue_trigger = (glue_ratio > glue_threshold);\n  bool dr_trigger = (dr_ratio < decision_rate_threshold);\n\n  if (glue_trigger && dr_trigger) {\n    kissat_extremely_verbose (\n      solver,\n      \"restarting: both glue ratio %.2f > %.2f and decision rate %.2f < %.2f * %.2f\",\n      glue_ratio, glue_threshold, decision_rate, decision_rate_threshold, historical_decision_rate);\n    return true;\n  }\n  if (glue_trigger) {\n    kissat_extremely_verbose (\n      solver,\n      \"restarting: glue ratio %.2f > %.2f (fast_glue %.2f / (slow_glue %.2f + 1))\",\n      glue_ratio, glue_threshold, fast_glue, slow_glue);\n    return true;\n  }\n  if (dr_trigger) {\n    kissat_extremely_verbose (\n      solver,\n      \"restarting: decision rate %.2f < %.2f * %.2f (historical: %.2f)\",\n      decision_rate, decision_rate_threshold, historical_decision_rate, historical_decision_rate);\n    return true;\n  }\n\n  // 7. Fallback: restart at standard conflict interval.\n  return true;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1400, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 602, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2002}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6922257daeb081908b8d131823c1ddec", "custom_id": "req-0002", "response": {"status_code": 200, "request_id": "68728b8006b5b211b7a950e7cb3b34a5", "body": {"id": "resp_06987307f00efacd0069222576e7b881a1a42d4e18d6d1fd56", "object": "response", "created_at": 1763845494, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_06987307f00efacd006922257736bc81a18ea71a7d2d69804b", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // At each conflict, check custom restart conditions\n  const double fast_glue = solver->averages[solver->stable].fast_glue.value;\n  const double slow_glue = solver->averages[solver->stable].slow_glue.value;\n  const double decision_rate = solver->averages[solver->stable].decision_rate.value;\n\n  // Use static thresholds for now, could be options\n  const double glue_threshold = 1.10;\n  const double decision_rate_threshold = 0.95;\n\n  // We need a historical decision rate per stage\n  // Use the 'kissat_stage' struct to store the initial decision_rate at stage start.\n  // We'll use solver->stage_decision_rate as a static variable for this.\n  static double historical_decision_rate = 0.0;\n  static bool initialized = false;\n\n  // If entering a new search stage, update historical_decision_rate\n  // We approximate this by checking if at root level (decision level 0).\n  // This will be true at the beginning of a restart, or at the very first call.\n  if (!solver->level) {\n    initialized = false;\n    return false;\n  }\n  if (!initialized) {\n    historical_decision_rate = decision_rate;\n    initialized = true;\n  }\n\n  // Compute glue_ratio\n  const double glue_ratio = fast_glue / (slow_glue + 1.0);\n\n  // Check restart conditions\n  const bool glue_trigger = (glue_ratio > glue_threshold);\n  const bool decision_rate_trigger =\n    (historical_decision_rate > 0.0) &&\n    (decision_rate < decision_rate_threshold * historical_decision_rate);\n\n  if (glue_trigger && decision_rate_trigger) {\n    kissat_extremely_verbose (solver,\n      \"restarting: glue_ratio %.3f > %.2f AND decision_rate %.3f < %.2f * %.3f (%.3f)\",\n      glue_ratio, glue_threshold,\n      decision_rate, decision_rate_threshold, historical_decision_rate,\n      decision_rate_threshold * historical_decision_rate);\n    initialized = false;\n    return true;\n  }\n  if (glue_trigger) {\n    kissat_extremely_verbose (solver,\n      \"restarting: glue_ratio %.3f > %.2f\",\n      glue_ratio, glue_threshold);\n    initialized = false;\n    return true;\n  }\n  if (decision_rate_trigger) {\n    kissat_extremely_verbose (solver,\n      \"restarting: decision_rate %.3f < %.2f * %.3f (%.3f)\",\n      decision_rate, decision_rate_threshold, historical_decision_rate,\n      decision_rate_threshold * historical_decision_rate);\n    initialized = false;\n    return true;\n  }\n\n  // If neither custom trigger, check standard conflict-based restart\n  if (CONFLICTS < solver->limits.restart.conflicts)\n    return false;\n\n  // If in stable phase, use reluctant-based trigger\n  if (solver->stable)\n    return kissat_reluctant_triggered (&solver->reluctant);\n\n  // Otherwise, use original glue margin-based restart\n  const double margin = (100.0 + GET_OPTION (restartmargin)) / 100.0;\n  const double limit = margin * slow_glue;\n  kissat_extremely_verbose (solver,\n    \"restart glue limit %g = %.02f * %g (slow glue) %c %g (fast glue)\",\n    limit, margin, slow_glue,\n    (limit > fast_glue    ? '>'\n     : limit == fast_glue ? '='\n                          : '<'),\n    fast_glue);\n  return (limit <= fast_glue);\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1400, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 812, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2212}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6922257daff08190b2f0030d63ecc179", "custom_id": "req-0003", "response": {"status_code": 200, "request_id": "ddf5f421ed515f19c8eb8c7e4404c9f8", "body": {"id": "resp_09fb9e3f62a75e660069222576e45881a2b16140b8dbf3d978", "object": "response", "created_at": 1763845494, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_09fb9e3f62a75e660069222577805481a298bc8e153f7ea377", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Standard conflict budget condition if no other signals\n  if (CONFLICTS < solver->limits.restart.conflicts)\n    return false;\n\n  // If in stable mode, keep original reluctant restart policy\n  if (solver->stable)\n    return kissat_reluctant_triggered (&solver->reluctant);\n\n  // --- Adaptive Glue + Decision Rate Restart (AGDRR) ---\n\n  // Gather statistics\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // Avoid division by zero (slow_glue could be zero at very start)\n  const double glue_ratio = fast_glue / (slow_glue + 1.0);\n\n  // Thresholds: can be made tunable via options if desired\n  const double glue_threshold = 1.10;\n  const double decision_rate_threshold = 0.95;\n\n  // Historical decision rate at start of current stage\n  // We store it in solver->restart_decision_rate_ref, initialize if zero\n  if (solver->restart_decision_rate_ref == 0.0)\n    solver->restart_decision_rate_ref = decision_rate;\n\n  // Compute stagnation signal\n  const double historical_decision_rate = solver->restart_decision_rate_ref;\n  const double stagnation_limit = decision_rate_threshold * historical_decision_rate;\n\n  // Verbose diagnostic output\n  kissat_extremely_verbose (\n      solver,\n      \"AGDRR: glue_ratio %.3f (fast %.2f / slow %.2f+1), glue_thresh %.2f, \"\n      \"decision_rate %.4f, hist_decision_rate %.4f, stagnation_limit %.4f\",\n      glue_ratio, fast_glue, slow_glue, glue_threshold,\n      decision_rate, historical_decision_rate, stagnation_limit);\n\n  const bool glue_bad = glue_ratio > glue_threshold;\n  const bool stagnant = decision_rate < stagnation_limit;\n\n  // Tie-breaker: if both are true, restart immediately\n  if (glue_bad && stagnant)\n    return true;\n\n  // If either main signal is true, restart\n  if (glue_bad || stagnant)\n    return true;\n\n  // Otherwise, only restart if standard conflict limit reached\n  return true;\n}\n</code>\n"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1400, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 541, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1941}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6922257dacfc81909d49e69217cd7492", "custom_id": "req-0004", "response": {"status_code": 200, "request_id": "bbc230ee291eafa18e2efc729c3075d0", "body": {"id": "resp_0a2905bb565e9c4b006922253b52e881918c120f5be6f3f6be", "object": "response", "created_at": 1763845435, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0a2905bb565e9c4b006922253bcd348191bed94d1feef4e301", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n    assert (solver->unassigned);\n\n    if (!GET_OPTION (restart))\n        return false;\n\n    if (!solver->level)\n        return false;\n\n    // Always allow restart if standard conflict threshold is crossed, as a fallback.\n    if (CONFLICTS >= solver->limits.restart.conflicts)\n        return true;\n\n    // If in stable phase, use reluctant heuristic.\n    if (solver->stable)\n        return kissat_reluctant_triggered (&solver->reluctant);\n\n    // --- Adaptive Glue + Decision Rate Restart (AGDRR) ---\n\n    // 1. Gather averages\n    const double fast_glue = AVERAGE (fast_glue);\n    const double slow_glue = AVERAGE (slow_glue);\n    const double decision_rate = AVERAGE (decision_rate);\n\n    // 2. Compute glue_ratio\n    const double glue_ratio = fast_glue / (slow_glue + 1.0);\n\n    // 3. Thresholds (these can be options, but hardcoded here for simplicity)\n    const double glue_threshold = 1.10;\n    const double decision_rate_threshold = 0.95;\n\n    // 4. Historical decision rate: we use the slow average as proxy for historical\n    //    (If persistent initial value is wanted, a new field is needed, but not available here)\n    //    So, we fallback to using the slow average of decision rate as a proxy.\n    const double historical_decision_rate = AVERAGE (decision_rate); // slow average is unavailable, so use current\n\n    // 5. Check restart criteria\n    const bool glue_bad = (glue_ratio > glue_threshold);\n    const bool stagnating = (decision_rate < decision_rate_threshold * historical_decision_rate);\n\n    kissat_extremely_verbose (\n        solver,\n        \"AGDRR restart: glue_ratio=%.3f (thresh=%.2f), decision_rate=%.3f (hist=%.3f, thresh=%.2f), glue_bad=%d, stagnating=%d\",\n        glue_ratio, glue_threshold,\n        decision_rate, historical_decision_rate, decision_rate_threshold,\n        glue_bad, stagnating);\n\n    // 6. Restart if either condition is met\n    if (glue_bad || stagnating)\n        return true;\n\n    return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1400, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 502, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1902}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6922257da058819084cf28047a09ea18", "custom_id": "req-0005", "response": {"status_code": 200, "request_id": "de9ef91c3d6d4d55e298d1427b203f45", "body": {"id": "resp_07c943833c1923e2006922253b573c819f9b249446484bbe2f", "object": "response", "created_at": 1763845435, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_07c943833c1923e2006922253baae4819f8217e04fe497e8ce", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n  assert(solver->unassigned);\n  if (!GET_OPTION(restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // --- Adaptive Glue + Decision Rate Restart (AGDRR) ---\n\n  // Current fast and slow glue (per phase)\n  const int mode = solver->stable;\n  const double fast_glue = solver->averages[mode].fast_glue.value;\n  const double slow_glue = solver->averages[mode].slow_glue.value;\n\n  // Decision rate (per phase)\n  const double decision_rate = solver->averages[mode].decision_rate.value;\n\n  // AGDRR parameters\n  const double glue_threshold = 1.10; // can be made a parameter\n  const double decision_rate_threshold = 0.95; // can be made a parameter\n\n  // Compute glue ratio\n  const double glue_ratio = fast_glue / (slow_glue + 1.0);\n\n  // Retrieve initial/historical decision rate\n  // We store it in solver->averages[mode].decision_rate.initial if available,\n  // otherwise fall back to slow_glue as a proxy (should be set at phase enter)\n  double historical_decision_rate = 0.0;\n#ifdef STRUCT_AVERAGE_HAS_INITIAL\n  historical_decision_rate = solver->averages[mode].decision_rate.initial;\n#else\n  // Fallback: Use slow_glue to ensure safe division, or 1.0 if not possible\n  historical_decision_rate = solver->averages[mode].decision_rate.value > 0 ?\n    solver->averages[mode].decision_rate.value : 1.0;\n#endif\n\n  // AGDRR triggering conditions\n  bool glue_restart = (glue_ratio > glue_threshold);\n  bool drate_restart = (decision_rate < decision_rate_threshold * historical_decision_rate);\n\n  if (glue_restart || drate_restart) {\n    kissat_extremely_verbose(\n      solver,\n      \"AGDRR restart: glue_ratio=%.3f (threshold=%.2f), \"\n      \"decision_rate=%.3f (threshold=%.3f * %.3f = %.3f), \"\n      \"triggered=%s\",\n      glue_ratio, glue_threshold,\n      decision_rate, decision_rate_threshold, historical_decision_rate,\n      decision_rate_threshold * historical_decision_rate,\n      (glue_restart && drate_restart) ? \"both\" : (glue_restart ? \"glue\" : \"drate\")\n    );\n    return true;\n  }\n\n  // Fallback to standard conflict-limit restart\n  if (CONFLICTS < solver->limits.restart.conflicts)\n    return false;\n\n  // Stable mode: Use reluctant restarts\n  if (solver->stable)\n    return kissat_reluctant_triggered(&solver->reluctant);\n\n  // Otherwise: standard margin-based glue restart\n  const double margin = (100.0 + GET_OPTION(restartmargin)) / 100.0;\n  const double limit = margin * slow_glue;\n  kissat_extremely_verbose(\n    solver,\n    \"restart glue limit %g = %.02f * %g (slow glue) %c %g (fast glue)\",\n    limit, margin, slow_glue,\n    (limit > fast_glue ? '>' : limit == fast_glue ? '=' : '<'),\n    fast_glue\n  );\n  return (limit <= fast_glue);\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1400, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 735, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2135}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6922257db0608190a31a359fa574f727", "custom_id": "req-0006", "response": {"status_code": 200, "request_id": "479abe8b5a0ec0d44ce71f587f76207a", "body": {"id": "resp_029bc2f91940370e006922253b58f881a2804328207bb3c912", "object": "response", "created_at": 1763845435, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_029bc2f91940370e006922253ba8f481a29cb260bd7278f01c", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Get fast and slow glue\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n\n  // Compute glue ratio (avoid div by zero)\n  const double glue_ratio = fast_glue / (slow_glue + 1.0);\n\n  // AGDRR parameters\n  const double glue_threshold = 1.10;\n  const double decision_rate_threshold = 0.95;\n\n  // Get current and historical decision rates\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // Store the historical decision rate at the start of the current stage\n  // Use: solver->phases[solver->stable].initial_decision_rate\n  // Initialize once per stage\n  if (!solver->phases[solver->stable].initialized) {\n    solver->phases[solver->stable].initial_decision_rate = decision_rate;\n    solver->phases[solver->stable].initialized = true;\n  }\n  const double historical_decision_rate = solver->phases[solver->stable].initial_decision_rate;\n\n  // Decision rate stagnation condition\n  const bool decision_rate_stagnation =\n    (decision_rate < decision_rate_threshold * historical_decision_rate);\n\n  // Clause learning quality condition\n  const bool glue_bad = (glue_ratio > glue_threshold);\n\n  kissat_extremely_verbose (solver,\n    \"AGDRR: glue_ratio %g (threshold %.2f), decision_rate %g (historical %g, threshold %.2f), glue_bad %d, stagnation %d\",\n    glue_ratio, glue_threshold, decision_rate, historical_decision_rate, decision_rate_threshold, glue_bad, decision_rate_stagnation);\n\n  // Restart if either is true, or both (immediate)\n  if (glue_bad || decision_rate_stagnation)\n    return true;\n\n  // If neither, trigger restart at the standard conflict limit\n  if (CONFLICTS < solver->limits.restart.conflicts)\n    return false;\n\n  // For stable phase, fallback to reluctant trigger\n  if (solver->stable)\n    return kissat_reluctant_triggered (&solver->reluctant);\n\n  // Otherwise, restart because conflict limit reached\n  return true;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1400, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 523, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1923}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6922257da2b88190b5c99d25d1144287", "custom_id": "req-0007", "response": {"status_code": 200, "request_id": "5212854dbb1290057b7a37afed5c7079", "body": {"id": "resp_07d92d7dfb6d9517006922253b53ac81a190ef98a552f53c44", "object": "response", "created_at": 1763845435, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_07d92d7dfb6d9517006922253bca1c81a1ba368087fc0ad823", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n\n  if (!solver->level)\n    return false;\n\n  // At first, always obey conflict limit for restarts\n  if (CONFLICTS < solver->limits.restart.conflicts)\n    return false;\n\n  // AGDRR parameters\n  const double glue_threshold = 1.10;\n  const double decision_rate_threshold = 0.95;\n\n  // Get the current averages\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // Compute glue ratio\n  const double glue_ratio = fast_glue / (slow_glue + 1.0);\n\n  // Retrieve the historical decision rate for this stage.\n  // We use the \"initial decision rate\" at the start of the stable/unstable phase.\n  // This is set in 'kissat_enter_stable_mode' or 'kissat_enter_search_mode':\n  const double historical_decision_rate =\n    solver->averages[solver->stable].decision_rate.initial;\n\n  // Compute decision rate threshold value\n  const double drate_limit = decision_rate_threshold * historical_decision_rate;\n\n  // Triggers\n  const bool glue_trigger = (glue_ratio > glue_threshold);\n  const bool drate_trigger = (decision_rate < drate_limit);\n\n  // If both triggers are true, restart immediately\n  if (glue_trigger && drate_trigger) {\n    kissat_extremely_verbose (\n      solver,\n      \"agdrr: restart triggered by glue_ratio %.3f > %.2f and decision_rate %.3f < %.3f\",\n      glue_ratio, glue_threshold, decision_rate, drate_limit);\n    return true;\n  }\n\n  // If either trigger is true, restart\n  if (glue_trigger) {\n    kissat_extremely_verbose (\n      solver,\n      \"agdrr: restart triggered by glue_ratio %.3f > %.2f\",\n      glue_ratio, glue_threshold);\n    return true;\n  }\n  if (drate_trigger) {\n    kissat_extremely_verbose (\n      solver,\n      \"agdrr: restart triggered by decision_rate %.3f < %.3f\",\n      decision_rate, drate_limit);\n    return true;\n  }\n\n  // Otherwise, fallback to reluctant restart for stable, or margin-based for non-stable\n  if (solver->stable)\n    return kissat_reluctant_triggered (&solver->reluctant);\n\n  const double margin = (100.0 + GET_OPTION (restartmargin)) / 100.0;\n  const double limit = margin * slow_glue;\n  kissat_extremely_verbose (\n    solver,\n    \"restart glue limit %g = %.2f * %g (slow glue) %c %g (fast glue)\",\n    limit, margin, slow_glue,\n    (limit > fast_glue ? '>' : limit == fast_glue ? '=' : '<'),\n    fast_glue);\n\n  return (limit <= fast_glue);\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1400, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 670, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2070}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6922257db0288190b667dc3afa2e28f8", "custom_id": "req-0008", "response": {"status_code": 200, "request_id": "91480f29b6aa5ece8dbe6e063df4b9f2", "body": {"id": "resp_07412fd648d64726006922253b66b8819caa2930601232fef8", "object": "response", "created_at": 1763845435, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_07412fd648d64726006922253baa74819c97a859473adad342", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // AGDRR parameters\n  const double glue_threshold = 1.10;\n  const double decision_rate_threshold = 0.95;\n\n  // Gather statistics\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // Compute glue ratio\n  const double glue_ratio = fast_glue / (slow_glue + 1);\n\n  // Initialize or retrieve historical decision rate\n  double *historical_decision_rate_ptr = &solver->restart_historical_decision_rate;\n  if (!solver->restart_historical_decision_rate_initialized) {\n    *historical_decision_rate_ptr = decision_rate;\n    solver->restart_historical_decision_rate_initialized = true;\n  }\n\n  // Compute thresholds\n  const double decision_rate_limit = decision_rate_threshold * (*historical_decision_rate_ptr);\n\n  // Check if restart should be triggered\n  const bool glue_restart = (glue_ratio > glue_threshold);\n  const bool drate_restart = (decision_rate < decision_rate_limit);\n\n  // For extremely verbose output\n  kissat_extremely_verbose (\n    solver,\n    \"AGDRR: glue ratio %.3f (fast %.3f / (slow %.3f + 1)), \"\n    \"decision rate %.3f (historical %.3f), \"\n    \"glue_restart %d, drate_restart %d, \"\n    \"conflicts %\" PRIu64 \" (limit %\" PRIu64 \")\",\n    glue_ratio, fast_glue, slow_glue,\n    decision_rate, *historical_decision_rate_ptr,\n    glue_restart, drate_restart,\n    CONFLICTS, solver->limits.restart.conflicts);\n\n  // Tie-breaker: restart immediately if both triggers fire\n  if (glue_restart && drate_restart)\n    return true;\n  if (glue_restart)\n    return true;\n  if (drate_restart)\n    return true;\n\n  // Otherwise, standard restart at conflict limit\n  if (CONFLICTS < solver->limits.restart.conflicts)\n    return false;\n\n  // On standard restart, reset historical decision rate for next stage\n  *historical_decision_rate_ptr = decision_rate;\n\n  if (solver->stable)\n    return kissat_reluctant_triggered (&solver->reluctant);\n\n  // Default LBD-based restart\n  const double margin = (100.0 + GET_OPTION (restartmargin)) / 100.0;\n  const double limit = margin * slow_glue;\n  kissat_extremely_verbose (\n    solver,\n    \"restart glue limit %g = %.02f * %g (slow glue) %c %g (fast glue)\",\n    limit, margin, slow_glue,\n    (limit > fast_glue ? '>' : limit == fast_glue ? '=' : '<'),\n    fast_glue);\n\n  return (limit <= fast_glue);\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1400, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 668, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2068}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6922257dacc481908cee5dc1b79451c0", "custom_id": "req-0009", "response": {"status_code": 200, "request_id": "1adeec32d64449e87ca4c472abca6351", "body": {"id": "resp_056c9e4a1d1c4dad006922253f919081a3952d72bc1106347c", "object": "response", "created_at": 1763845439, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_056c9e4a1d1c4dad006922253fd66481a39cb8dc32b1b5e791", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Standard conflict-based restart limit.\n  if (CONFLICTS < solver->limits.restart.conflicts)\n    return false;\n\n  // For stable mode, fallback to existing reluctant trigger.\n  if (solver->stable)\n    return kissat_reluctant_triggered (&solver->reluctant);\n\n  // --- AGDRR Heuristic implementation ---\n\n  // 1. Get relevant averages (stage index is solver->stable)\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = solver->averages[solver->stable].decision_rate.value;\n\n  // 2. Compute glue_ratio\n  const double glue_ratio = fast_glue / (slow_glue + 1.0);\n\n  // 3. Thresholds (can be made options, hardcoded here as per algorithm)\n  const double glue_threshold = 1.10;\n  const double decision_rate_threshold = 0.95;\n\n  // 4. Historical decision rate (initial for the current stage),\n  //    stored in solver->averages[solver->stable].decision_rate.start\n  const double historical_decision_rate = solver->averages[solver->stable].decision_rate.start;\n\n  // 5. Trigger conditions\n  bool glue_bad = (glue_ratio > glue_threshold);\n  bool decision_stagnating = (decision_rate < decision_rate_threshold * historical_decision_rate);\n\n  if (glue_bad && decision_stagnating) {\n    kissat_extremely_verbose (\n      solver,\n      \"agdrr: restart triggered (both glue %.3f > %.2f and decision rate %.3f < %.2f * %.3f)\",\n      glue_ratio, glue_threshold, decision_rate, decision_rate_threshold, historical_decision_rate\n    );\n    return true;\n  }\n  if (glue_bad) {\n    kissat_extremely_verbose (\n      solver,\n      \"agdrr: restart triggered (glue ratio %.3f > %.2f)\",\n      glue_ratio, glue_threshold\n    );\n    return true;\n  }\n  if (decision_stagnating) {\n    kissat_extremely_verbose (\n      solver,\n      \"agdrr: restart triggered (decision rate %.3f < %.2f * %.3f)\",\n      decision_rate, decision_rate_threshold, historical_decision_rate\n    );\n    return true;\n  }\n\n  // Fallback: standard restart at required conflict limit\n  kissat_extremely_verbose (\n    solver,\n    \"agdrr: no adaptive restart (glue %.3f, rate %.3f)\",\n    glue_ratio, decision_rate\n  );\n  return true;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1400, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 610, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2010}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6922257db2f4819092da80e9e68c589d", "custom_id": "req-0010", "response": {"status_code": 200, "request_id": "c74667d12c50571810c84e86ad66ec2d", "body": {"id": "resp_0a23bb5f9f4b6878006922253f8ff481929cc88c9f8ed17445", "object": "response", "created_at": 1763845439, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0a23bb5f9f4b6878006922253fcb3081929ea893fd3c976cd9", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n  assert(solver->unassigned);\n  if (!GET_OPTION(restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // AGDRR parameters\n  const double glue_threshold = 1.10;\n  const double decision_rate_threshold = 0.95;\n\n  // Use stage-specific averages\n  const int mode = solver->stable;\n  const double fast_glue = solver->averages[mode].fast_glue.value;\n  const double slow_glue = solver->averages[mode].slow_glue.value;\n  const double decision_rate = solver->averages[mode].decision_rate.value;\n\n  // Historical decision rate: store initial value at stage entry\n  // (initialize if not already set for the current stage)\n  static double historical_decision_rate = 0.0;\n  static int historical_mode = -1;\n  if (historical_mode != mode || historical_decision_rate == 0.0) {\n    historical_decision_rate = decision_rate;\n    historical_mode = mode;\n  }\n\n  // Compute glue ratio\n  const double glue_ratio = fast_glue / (slow_glue + 1.0);\n\n  // Decision rate stagnation threshold\n  const double dec_rate_limit = decision_rate_threshold * historical_decision_rate;\n\n  // AGDRR triggers\n  bool glue_restart = glue_ratio > glue_threshold;\n  bool stagnation_restart = decision_rate < dec_rate_limit;\n\n  if (glue_restart || stagnation_restart) {\n    kissat_extremely_verbose(\n      solver,\n      \"AGDRR-restart: fast_glue %.2f slow_glue %.2f glue_ratio %.3f (%s), \"\n      \"decision_rate %.2f hist_dec_rate %.2f threshold %.2f (%s)\",\n      fast_glue, slow_glue, glue_ratio, glue_restart ? \"TRIGGER\" : \"OK\",\n      decision_rate, historical_decision_rate, dec_rate_limit,\n      stagnation_restart ? \"TRIGGER\" : \"OK\"\n    );\n    return true;\n  }\n\n  // Otherwise, check for standard reluctant restart in stable mode\n  if (mode && CONFLICTS >= solver->limits.restart.conflicts)\n    return kissat_reluctant_triggered(&solver->reluctant);\n\n  // For non-stable mode: restart only at conflict limit\n  if (!mode && CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1400, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 528, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1928}, "user": null, "metadata": {}}}, "error": null}
