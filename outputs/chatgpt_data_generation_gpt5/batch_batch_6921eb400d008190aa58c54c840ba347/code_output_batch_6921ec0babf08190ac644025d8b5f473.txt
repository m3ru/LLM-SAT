{"id": "batch_req_6921eca26ccc8190b4862b34cad89402", "custom_id": "req-0001", "response": {"status_code": 200, "request_id": "9aee62fe47a36eacd64166799745f747", "body": {"id": "resp_0b8eec226593eedb006921ec994204819795e9f59ceec4661f", "object": "response", "created_at": 1763830937, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0b8eec226593eedb006921ec9978c88197b4986d3ce3097209", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Always force restart if conflict limit is reached\n  if (CONFLICTS < solver->limits.restart.conflicts)\n    return false;\n\n  // Maintain static variables for long-term rate and last restart\n  static double long_term_decision_rate = 0.0;\n  static uint64_t last_update_conflicts = 0;\n  static uint64_t last_restart_conflict = 0;\n\n  // Only update long_term_decision_rate once per conflict\n  if (last_update_conflicts != solver->statistics.conflicts) {\n    const double alpha = 1.0 / 1000.0;\n    const double curr_rate = solver->averages[solver->stable].decision_rate.value;\n    if (long_term_decision_rate == 0.0)\n      long_term_decision_rate = curr_rate;\n    else\n      long_term_decision_rate = (1.0 - alpha) * long_term_decision_rate + alpha * curr_rate;\n    last_update_conflicts = solver->statistics.conflicts;\n  }\n\n  // Minimum interval between restarts\n  const uint64_t min_interval = solver->stable ? 200 : 50;\n  if (solver->statistics.conflicts < last_restart_conflict + min_interval)\n    return false;\n\n  // Compute thresholds\n  const double fast_glue = solver->averages[solver->stable].fast_glue.value;\n  const double slow_glue = solver->averages[solver->stable].slow_glue.value;\n  const double decision_rate = solver->averages[solver->stable].decision_rate.value;\n\n  const double glue_threshold = 0.95 * slow_glue;\n  const double rate_threshold = 0.85 * long_term_decision_rate;\n\n  // Tie-breaking: If thresholds are closely met (within 3%), prefer to restart\n  bool glue_close = false, rate_close = false;\n  if (slow_glue > 0.0)\n    glue_close = (fast_glue > 0.92 * slow_glue) && (fast_glue <= glue_threshold);\n  if (long_term_decision_rate > 0.0)\n    rate_close = (decision_rate < 0.88 * long_term_decision_rate) && (decision_rate >= rate_threshold);\n\n  bool glue_ok = (fast_glue > glue_threshold);\n  bool rate_ok = (decision_rate < rate_threshold);\n\n  bool restart = false;\n\n  // If both main conditions are met, restart\n  if (glue_ok && rate_ok)\n    restart = true;\n  // If both conditions are closely met, prefer to restart\n  else if (glue_close && rate_close)\n    restart = true;\n\n  if (restart) {\n    last_restart_conflict = solver->statistics.conflicts;\n    kissat_extremely_verbose (\n      solver,\n      \"DGAR restart: fast_glue=%.2f slow_glue=%.2f (threshold=%.2f), \"\n      \"decision_rate=%.6f long_term=%.6f (threshold=%.6f) at conflict %\" PRIu64,\n      fast_glue, slow_glue, glue_threshold,\n      decision_rate, long_term_decision_rate, rate_threshold,\n      solver->statistics.conflicts\n    );\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 733, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1513}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921eca2532881908ab837591b5f10e2", "custom_id": "req-0002", "response": {"status_code": 200, "request_id": "495157ffc4b101e0ad24f8aea4e10023", "body": {"id": "resp_0fa967bbe9acfc10006921ec10c3388197a21d9666798c6a2b", "object": "response", "created_at": 1763830800, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0fa967bbe9acfc10006921ec113014819789bdfd1aed668d06", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Force restart if conflict limit is reached.\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Parameters (constants for this heuristic)\n  const int min_interval = solver->stable ? 200 : 50;\n  const double glue_margin = 0.95;\n  const double decision_margin = 0.85;\n  const double tie_margin = 0.03; // 3%\n\n  // Static state for long-term decision rate and last restart conflict.\n  static double long_term_decision_rate = 0.0;\n  static uint64_t last_update_conflicts = 0;\n  static uint64_t last_restart_conflict = 0;\n\n  // Update long term decision rate every conflict.\n  if (last_update_conflicts != CONFLICTS) {\n    // O(1) running average over ~1000 conflicts.\n    double alpha = 1.0 / 1000.0;\n    double current = AVERAGE (decision_rate);\n    if (long_term_decision_rate == 0.0)\n      long_term_decision_rate = current;\n    else\n      long_term_decision_rate =\n        (1.0 - alpha) * long_term_decision_rate + alpha * current;\n    last_update_conflicts = CONFLICTS;\n  }\n\n  // Enforce minimum interval between restarts.\n  if (CONFLICTS < last_restart_conflict + min_interval)\n    return false;\n\n  // Compute glue and decision rate thresholds.\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  const double glue_threshold = glue_margin * slow_glue;\n  const double decision_threshold = decision_margin * long_term_decision_rate;\n\n  // Main trigger: both glue and decision rate thresholds.\n  bool glue_cond = (fast_glue > glue_threshold);\n  bool decision_cond = (decision_rate < decision_threshold);\n\n  // Tie-breaking: if within 3% of threshold, prefer to restart.\n  bool glue_tie = fabs (fast_glue - glue_threshold) <= (tie_margin * slow_glue);\n  bool decision_tie = fabs (decision_rate - decision_threshold) <= (tie_margin * long_term_decision_rate);\n\n  if ((glue_cond && decision_cond) ||\n      (glue_tie && decision_tie)) {\n    last_restart_conflict = CONFLICTS;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 577, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1357}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921eca24d308190add121109863fcfc", "custom_id": "req-0003", "response": {"status_code": 200, "request_id": "ad75c63599c87572dc3e675321c42f9c", "body": {"id": "resp_0c9d25a38f5903c5006921ec16158481938f1552838703a1a9", "object": "response", "created_at": 1763830806, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0c9d25a38f5903c5006921ec1647548193b9e8923a8afc694a", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Forced restart if conflict limit reached\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // --- DGAR heuristic state ---\n  // We need persistent state for long_term_decision_rate and last_restart_conflict\n  // We attach these to the solver struct via the unused restart structure area\n  kissat_restart *rst = &solver->restart;\n\n  // initialize persistent state if first call\n  if (!rst->dgar_initialized) {\n    rst->dgar_long_term_decision_rate = solver->averages[solver->stable].decision_rate.value;\n    rst->dgar_long_term_window = 1;\n    rst->dgar_last_restart_conflict = CONFLICTS ? CONFLICTS - 1 : 0;\n    rst->dgar_initialized = true;\n  }\n\n  // Update long_term_decision_rate as an O(1) running average over 1000 conflicts\n  const double decision_rate = solver->averages[solver->stable].decision_rate.value;\n  if (CONFLICTS > rst->dgar_last_update_conflict) {\n    unsigned window = rst->dgar_long_term_window;\n    if (window < 1000) window++;\n    rst->dgar_long_term_decision_rate += (decision_rate - rst->dgar_long_term_decision_rate) / window;\n    rst->dgar_long_term_window = window;\n    rst->dgar_last_update_conflict = CONFLICTS;\n  }\n  const double long_term_decision_rate = rst->dgar_long_term_decision_rate;\n\n  // Get glue averages\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n\n  // Get thresholds\n  const double glue_threshold = 0.95 * slow_glue;\n  const double decision_rate_threshold = 0.85 * long_term_decision_rate;\n\n  // Tie-breaking margin (3%)\n  const double glue_margin = 0.03 * slow_glue;\n  const double decision_rate_margin = 0.03 * long_term_decision_rate;\n\n  // Minimum interval between restarts\n  unsigned min_interval = solver->stable ? 200 : 50;\n  unsigned since_last_restart = CONFLICTS > rst->dgar_last_restart_conflict\n                                 ? (unsigned)(CONFLICTS - rst->dgar_last_restart_conflict)\n                                 : 0;\n\n  bool glue_ok = fast_glue > glue_threshold;\n  bool decision_ok = decision_rate < decision_rate_threshold;\n\n  // Tie-breaking: if thresholds are within margin, prefer restart\n  bool glue_close = fabs(fast_glue - glue_threshold) <= glue_margin;\n  bool decision_close = fabs(decision_rate - decision_rate_threshold) <= decision_rate_margin;\n\n  bool eligible =\n    (glue_ok && decision_ok) ||\n    ((glue_close && decision_close) && (fast_glue > glue_threshold));\n\n  if (eligible && since_last_restart >= min_interval) {\n    rst->dgar_last_restart_conflict = CONFLICTS;\n    kissat_extremely_verbose (\n      solver,\n      \"DGAR restart: fast_glue=%.2f slow_glue=%.2f (thr=%.2f) decision_rate=%.2f long_term=%.2f (thr=%.2f) interval=%u/%u\",\n      fast_glue, slow_glue, glue_threshold, decision_rate, long_term_decision_rate, decision_rate_threshold,\n      since_last_restart, min_interval\n    );\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 798, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1578}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921eca24de88190ac6a04899ccff1b8", "custom_id": "req-0004", "response": {"status_code": 200, "request_id": "cdf470c47704f9d0bd8ac732f9b7ad34", "body": {"id": "resp_0657304481740845006921ec1c936c81978b7070160d22d66f", "object": "response", "created_at": 1763830812, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0657304481740845006921ec1cc8bc81979ebbf7d21dfdae97", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n\n  if (!solver->level)\n    return false;\n\n  const uint64_t conflicts = solver->statistics.conflicts;\n\n  // Force restart if conflict limit reached\n  if (conflicts >= solver->limits.restart.conflicts)\n    return true;\n\n  // Minimum interval between restarts\n  const unsigned min_interval = solver->stable ? 200 : 50;\n  static uint64_t last_restart_conflict = 0;\n  if (conflicts < last_restart_conflict + min_interval)\n    return false;\n\n  // EWMA values\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // Maintain long-term decision rate as O(1) running average over 1000 conflicts\n  // Use solver->long_term_decision_rate to store it, initialize if unset\n  if (!solver->long_term_decision_rate_initialized) {\n    solver->long_term_decision_rate = decision_rate;\n    solver->long_term_decision_rate_initialized = true;\n  } else if (solver->statistics.conflicts > solver->long_term_decision_rate_last_update) {\n    // Update once per conflict, EWMA with alpha = 1/1000\n    const double alpha = 1.0 / 1000.0;\n    solver->long_term_decision_rate =\n      (1.0 - alpha) * solver->long_term_decision_rate + alpha * decision_rate;\n    solver->long_term_decision_rate_last_update = solver->statistics.conflicts;\n  }\n\n  const double long_term_decision_rate = solver->long_term_decision_rate;\n\n  // Scoring thresholds\n  const double glue_threshold = 0.95 * slow_glue;\n  const double decision_rate_threshold = 0.85 * long_term_decision_rate;\n\n  bool glue_ok = fast_glue > glue_threshold;\n  bool decision_rate_ok = decision_rate < decision_rate_threshold;\n\n  // Tie-break: within 3% margin, prefer to restart\n  bool glue_close = fabs(fast_glue - glue_threshold) <= 0.03 * slow_glue;\n  bool drate_close = fabs(decision_rate - decision_rate_threshold) <= 0.03 * long_term_decision_rate;\n\n  if ((glue_ok && decision_rate_ok) ||\n      ((glue_close && drate_close) && (fast_glue > glue_threshold || decision_rate < decision_rate_threshold)))\n  {\n    // If multiple restarts eligible, favor higher fast_glue (already implied)\n    last_restart_conflict = conflicts;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 597, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1377}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921eca2569481908b67a0b8cb80c19f", "custom_id": "req-0005", "response": {"status_code": 200, "request_id": "48ce0b20c725aa7bce1bd1e245760821", "body": {"id": "resp_0ea7d86ca8fb2cb0006921ec2185a881969cfe629b7e417806", "object": "response", "created_at": 1763830817, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0ea7d86ca8fb2cb0006921ec21dab88196baa885b478f129a7", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert(solver->unassigned);\n\n  if (!GET_OPTION(restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Forced restart: conflict limit reached\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Parameters for DGAR\n  const int min_interval = solver->stable ? 200 : 50;\n  static uint64_t last_restart_conflict = 0;\n  static double long_term_decision_rate = 0.0;\n  static uint64_t last_lt_update_conflict = 0;\n  static const int LT_WINDOW = 1000;\n\n  // Update running average of long-term decision rate (O(1) windowed average)\n  double decision_rate = solver->averages[solver->stable].decision_rate.value;\n  if (CONFLICTS != last_lt_update_conflict && CONFLICTS % LT_WINDOW == 0) {\n    long_term_decision_rate = decision_rate;\n    last_lt_update_conflict = CONFLICTS;\n  } else if (CONFLICTS > last_lt_update_conflict) {\n    // Exponential moving average update for LT window\n    const double alpha = 1.0 / LT_WINDOW;\n    long_term_decision_rate = (1.0 - alpha) * long_term_decision_rate + alpha * decision_rate;\n  }\n\n  // Enforce minimum interval between restarts\n  if (CONFLICTS - last_restart_conflict < min_interval)\n    return false;\n\n  // Obtain glue and decision rate averages\n  const double fast_glue = solver->averages[solver->stable].fast_glue.value;\n  const double slow_glue = solver->averages[solver->stable].slow_glue.value;\n\n  // Main DGAR thresholds\n  const double glue_threshold = 0.95 * slow_glue;\n  const double decision_rate_threshold = 0.85 * long_term_decision_rate;\n\n  const bool glue_cond = (fast_glue > glue_threshold);\n  const bool rate_cond = (decision_rate < decision_rate_threshold);\n\n  // Tie-breaking: if both ratios are within 3%, prefer restart\n  const bool glue_close = (fast_glue >= 0.97 * slow_glue);\n  const bool rate_close = (decision_rate <= 0.88 * long_term_decision_rate);\n\n  bool restart = false;\n  if (glue_cond && rate_cond) {\n    restart = true;\n  } else if (glue_close && rate_close) {\n    restart = true;\n  }\n\n  if (restart) {\n    last_restart_conflict = CONFLICTS;\n    kissat_extremely_verbose(\n      solver,\n      \"DGAR restart: fast_glue %.3f (thr %.3f), slow_glue %.3f, \"\n      \"decision_rate %.3f (thr %.3f), long_term_rate %.3f, \"\n      \"interval %u, stable %d\",\n      fast_glue, glue_threshold, slow_glue,\n      decision_rate, decision_rate_threshold, long_term_decision_rate,\n      min_interval, solver->stable\n    );\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 679, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1459}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921eca2558c8190b85799d82d08625c", "custom_id": "req-0006", "response": {"status_code": 200, "request_id": "93093ba0a239bc0cabf76ccdd1b5ac92", "body": {"id": "resp_0d342d617f4ca1a8006921ec26f2bc8196be9d54dd102a548f", "object": "response", "created_at": 1763830822, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0d342d617f4ca1a8006921ec2737a0819696c3017170f8d2cc", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Always restart if conflict limit is reached\n  if (CONFLICTS < solver->limits.restart.conflicts)\n    return false;\n\n  // --- DGAR algorithm state ---\n  // We need: long_term_decision_rate (O(1) running average over 1000 conflicts)\n  // We'll store it in solver->restart_long_term_decision_rate (double), which we must define here if not present.\n  // We'll also need the last restart conflict count for intervals. Use solver->restart_last_conflict.\n\n  // Initialize persistent DGAR state if not done\n  if (!solver->dgar_initialized) {\n    solver->restart_long_term_decision_rate = solver->averages[solver->stable].decision_rate.value;\n    solver->restart_long_term_weight = 1000.0;\n    solver->restart_last_conflict = solver->statistics.conflicts;\n    solver->dgar_initialized = true;\n  }\n\n  // Update running average for long_term_decision_rate\n  // O(1) weighted average: long_term += (decision_rate - long_term)/weight\n  double curr_decision_rate = solver->averages[solver->stable].decision_rate.value;\n  double long_term = solver->restart_long_term_decision_rate;\n  const double weight = 1000.0;\n  long_term += (curr_decision_rate - long_term) / weight;\n  solver->restart_long_term_decision_rate = long_term;\n\n  // Minimum interval between restarts\n  unsigned min_interval =\n    solver->stable ? 200 : 50;\n  uint64_t since_last_restart =\n    solver->statistics.conflicts - solver->restart_last_conflict;\n  bool min_interval_passed = since_last_restart >= min_interval;\n\n  // Fast and slow glue\n  const double fast_glue = solver->averages[solver->stable].fast_glue.value;\n  const double slow_glue = solver->averages[solver->stable].slow_glue.value;\n\n  // Decision rate thresholds\n  const double glue_threshold = 0.95 * slow_glue;\n  const double glue_tiebreak = 0.97 * slow_glue;\n  const double rate_threshold = 0.85 * long_term;\n  const double rate_tiebreak = 0.88 * long_term;\n\n  bool glue_met = (fast_glue > glue_threshold);\n  bool glue_close = (!glue_met && fast_glue > glue_tiebreak);\n  bool rate_met = (curr_decision_rate < rate_threshold);\n  bool rate_close = (!rate_met && curr_decision_rate < rate_tiebreak);\n\n  bool trigger = false;\n\n  // If both are met, restart (or if both are close, tiebreak in favor)\n  if (min_interval_passed)\n  {\n    if ((glue_met && rate_met) ||\n        ((glue_close && rate_close))) {\n      trigger = true;\n    }\n  }\n\n  // If multiple restarts are eligible, favor higher fast_glue (already implicit)\n  // If conflict limit is reached, force restart\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    trigger = true;\n\n  if (trigger) {\n    solver->restart_last_conflict = solver->statistics.conflicts;\n    kissat_extremely_verbose (solver,\n      \"DGAR restart: fast_glue=%.2f, slow_glue=%.2f, curr_rate=%.4f, long_term_rate=%.4f, interval=%\" PRIu64 \", min=%u, trigger=%d\",\n      fast_glue, slow_glue, curr_decision_rate, long_term, since_last_restart, min_interval, trigger);\n  }\n\n  return trigger;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 817, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1597}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921eca250d88190873cb547b1cfaa6f", "custom_id": "req-0007", "response": {"status_code": 200, "request_id": "9965eb8bc3e3bc30cd0817a2dab3493a", "body": {"id": "resp_014ec2b0a5b4ed87006921ec10993c8190a3a84b243a4b6c0a", "object": "response", "created_at": 1763830800, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_014ec2b0a5b4ed87006921ec10d42c81908c19498f97850917", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n  assert(solver->unassigned);\n\n  if (!GET_OPTION(restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Force restart if conflict limit reached\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // --- DGAR parameters ---\n  const unsigned interval = solver->stable ? 200 : 50;\n  static uint64_t last_restart_conflicts = 0;\n\n  // Enforce minimum interval between restarts\n  if (CONFLICTS < last_restart_conflicts + interval)\n    return false;\n\n  // Obtain glue averages\n  const double fast_glue = AVERAGE(fast_glue);\n  const double slow_glue = AVERAGE(slow_glue);\n\n  // Obtain current decision rate\n  const double decision_rate = solver->averages[solver->stable].decision_rate.value;\n\n  // Maintain long-term decision rate (O(1) running average over 1000 conflicts)\n  static double long_term_decision_rate = 0.0;\n  static uint64_t last_longterm_conflict = 0;\n\n  if (CONFLICTS != last_longterm_conflict) {\n    // Only update once per conflict\n    last_longterm_conflict = CONFLICTS;\n    if (long_term_decision_rate == 0.0)\n      long_term_decision_rate = decision_rate;\n    else\n      long_term_decision_rate += (decision_rate - long_term_decision_rate) / 1000.0;\n  }\n\n  // DGAR thresholds\n  const double glue_threshold = 0.95 * slow_glue;\n  const double decision_rate_threshold = 0.85 * long_term_decision_rate;\n\n  bool glue_cond = fast_glue > glue_threshold;\n  bool drate_cond = decision_rate < decision_rate_threshold;\n\n  // Tie-breaking: If both conditions are within 3%, prefer to restart\n  const double glue_margin = 0.03 * slow_glue;\n  const double drate_margin = 0.03 * long_term_decision_rate;\n\n  bool glue_close = (fast_glue > glue_threshold - glue_margin) && (fast_glue <= glue_threshold + glue_margin);\n  bool drate_close = (decision_rate < decision_rate_threshold + drate_margin) && (decision_rate > decision_rate_threshold - drate_margin);\n\n  if ((glue_cond && drate_cond) ||\n      (glue_close && drate_close)) {\n    kissat_extremely_verbose(\n      solver,\n      \"DGAR restart: fast_glue %.3f > %.3f (0.95 * slow_glue %.3f), \"\n      \"decision_rate %.3f < %.3f (0.85 * long_term_decision_rate %.3f), \"\n      \"interval %u conflicts\",\n      fast_glue, glue_threshold, slow_glue,\n      decision_rate, decision_rate_threshold, long_term_decision_rate,\n      interval\n    );\n    last_restart_conflicts = CONFLICTS;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 655, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1435}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921eca251208190989458c015d16cce", "custom_id": "req-0008", "response": {"status_code": 200, "request_id": "f7c40c6028ba7ae3c92e974fc5e9cbb6", "body": {"id": "resp_0053ec1c924c16f2006921ec2d9ef88190a89a5a6092e5c48a", "object": "response", "created_at": 1763830829, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0053ec1c924c16f2006921ec2ddde881908450da30a5caf17e", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Force restart if conflict limit reached\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Compute EWMA averages\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // Maintain long-term decision rate as O(1) running average over last 1000 conflicts\n  // Use static variable as this function is called every conflict\n  static double long_term_decision_rate = 0.0;\n  static uint64_t last_conflict = 0;\n  static uint64_t last_restart_conflict = 0;\n\n  const uint64_t current_conflict = CONFLICTS;\n\n  // Only update long_term_decision_rate if a conflict has progressed\n  if (current_conflict != last_conflict) {\n    // O(1) running average with alpha = 1/1000\n    const double alpha = 1.0 / 1000.0;\n    if (long_term_decision_rate == 0.0)\n      long_term_decision_rate = decision_rate;\n    else\n      long_term_decision_rate = (1.0 - alpha) * long_term_decision_rate + alpha * decision_rate;\n    last_conflict = current_conflict;\n  }\n\n  // Enforce minimum interval between restarts\n  uint64_t min_interval = solver->stable ? 200 : 50;\n  if (current_conflict < last_restart_conflict + min_interval)\n    return false;\n\n  // Scoring thresholds\n  const double glue_ratio = fast_glue / slow_glue;\n  const double glue_threshold = 0.95;\n  const double glue_tiebreak = 0.97;\n  const double decision_rate_threshold = 0.85;\n  const double decision_rate_tiebreak = 0.88;\n\n  bool glue_trigger = glue_ratio > glue_threshold;\n  bool drate_trigger = decision_rate < decision_rate_threshold * long_term_decision_rate;\n\n  // Tie-breaking: both conditions within 3%\n  bool glue_close = glue_ratio > glue_tiebreak && glue_ratio <= glue_threshold + 0.03;\n  bool drate_close = decision_rate < decision_rate_tiebreak * long_term_decision_rate &&\n                     decision_rate >= decision_rate_threshold * long_term_decision_rate - 0.03 * long_term_decision_rate;\n\n  if ((glue_trigger && drate_trigger) ||\n       (glue_close && drate_close)) {\n    last_restart_conflict = current_conflict;\n    kissat_extremely_verbose (solver,\n      \"DGAR restart: fast_glue %.4f, slow_glue %.4f (ratio %.3f), \"\n      \"decision_rate %.4f, long_term_decision_rate %.4f\",\n      fast_glue, slow_glue, glue_ratio, decision_rate, long_term_decision_rate);\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 681, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1461}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921eca254f08190a08a4b5e7ef09698", "custom_id": "req-0009", "response": {"status_code": 200, "request_id": "1a90df2b17104e8040ea6cd7871e579a", "body": {"id": "resp_06f21c368f1b2399006921ec15c4508195b9315d90140cbd18", "object": "response", "created_at": 1763830805, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_06f21c368f1b2399006921ec1682cc8195bb619bed7f03833a", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Force restart if limit of conflicts is reached\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Compute minimum interval between restarts, depending on stable mode\n  unsigned min_interval = solver->stable ? 200 : 50;\n\n  // Track last restart conflict to enforce minimum interval\n  static uint64_t last_restart_conflict = 0;\n  uint64_t current_conflicts = CONFLICTS;\n  if (current_conflicts < last_restart_conflict + min_interval)\n    return false;\n\n  // Extract moving averages\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // Maintain long-term decision rate as O(1) running average over last 1000 conflicts\n  static double long_term_decision_rate = 0.0;\n  static uint64_t last_update_conflicts = 0;\n  if (current_conflicts != last_update_conflicts) {\n    // Update only once per conflict\n    const double alpha = 1.0 / 1000.0;\n    if (long_term_decision_rate == 0.0)\n      long_term_decision_rate = decision_rate;\n    else\n      long_term_decision_rate = (1.0 - alpha) * long_term_decision_rate + alpha * decision_rate;\n    last_update_conflicts = current_conflicts;\n  }\n\n  // Compute thresholds\n  const double glue_threshold = 0.95 * slow_glue;\n  const double decision_rate_threshold = 0.85 * long_term_decision_rate;\n\n  // Compute closeness for tie-breaking (within 3%)\n  const double glue_margin = 0.03 * slow_glue;\n  const double decision_rate_margin = 0.03 * long_term_decision_rate;\n\n  bool glue_condition = (fast_glue > glue_threshold);\n  bool decision_rate_condition = (decision_rate < decision_rate_threshold);\n\n  bool glue_close = (fast_glue > glue_threshold - glue_margin && fast_glue <= glue_threshold + glue_margin);\n  bool decision_rate_close = (decision_rate < decision_rate_threshold + decision_rate_margin &&\n                              decision_rate > decision_rate_threshold - decision_rate_margin);\n\n  // Both conditions must be met, or tie-breaking if both are close\n  bool restart = false;\n  if (glue_condition && decision_rate_condition)\n    restart = true;\n  else if (glue_close && decision_rate_close)\n    restart = true;\n\n  if (restart) {\n    last_restart_conflict = current_conflicts;\n    return true;\n  }\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 611, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1391}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921eca249888190a1796592a9978424", "custom_id": "req-0010", "response": {"status_code": 200, "request_id": "c89701a4ff16a5640d54519f645db8f2", "body": {"id": "resp_027f358a89cb96ae006921ec32f8948194bb45a6082cdf0c37", "object": "response", "created_at": 1763830834, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_027f358a89cb96ae006921ec333f3c819490b400c98a799c91", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Force restart if hard conflict limit reached\n  if (CONFLICTS < solver->limits.restart.conflicts)\n    return false;\n\n  // --- DGAR state: maintain long_term_decision_rate and last restart conflict ---\n  // We'll use solver->restart for persistent data between calls\n  if (!solver->dgar_initialized) {\n    solver->dgar_long_term_decision_rate = solver->averages[solver->stable].decision_rate.value;\n    solver->dgar_ltdr_conflicts = CONFLICTS;\n    solver->dgar_last_restart_conflict = 0;\n    solver->dgar_initialized = true;\n  }\n\n  // Update long_term_decision_rate as O(1) running average over 1000 conflicts\n  uint64_t since_last_ltdr = CONFLICTS - solver->dgar_ltdr_conflicts;\n  if (since_last_ltdr > 0) {\n    double curr = solver->averages[solver->stable].decision_rate.value;\n    double alpha = (since_last_ltdr >= 1000) ? 1.0 : ((double)since_last_ltdr)/1000.0;\n    solver->dgar_long_term_decision_rate = (1.0 - alpha) * solver->dgar_long_term_decision_rate + alpha * curr;\n    solver->dgar_ltdr_conflicts = CONFLICTS;\n  }\n\n  // Minimum interval between restarts\n  int min_interval = solver->stable ? 200 : 50;\n  if (CONFLICTS - solver->dgar_last_restart_conflict < min_interval)\n    return false;\n\n  // Glue and decision rate thresholds\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  const double glue_threshold = 0.95 * slow_glue;\n  const double glue_close = 0.97 * slow_glue;\n  const double dr_threshold = 0.85 * solver->dgar_long_term_decision_rate;\n  const double dr_close = 0.88 * solver->dgar_long_term_decision_rate;\n\n  bool glue_cond = fast_glue > glue_threshold;\n  bool dr_cond = decision_rate < dr_threshold;\n\n  bool glue_tiebreak = (fast_glue > glue_close);\n  bool dr_tiebreak = (decision_rate < dr_close);\n\n  bool eligible = false;\n\n  // Both conditions met, or tie-break if close\n  if ((glue_cond && dr_cond) ||\n      ((fast_glue > glue_threshold - 1e-6 && fast_glue <= glue_close && decision_rate < dr_close) ||\n       (fast_glue > glue_close && decision_rate < dr_threshold + 1e-6 && decision_rate >= dr_close)))\n    eligible = true;\n\n  // Stable mode: still must pass reluctant trigger (for Luby)\n  if (solver->stable) {\n    if (!eligible)\n      return false;\n    if (!kissat_reluctant_triggered (&solver->reluctant))\n      return false;\n  } else if (!eligible) {\n    return false;\n  }\n\n  // All checks passed, trigger restart\n  solver->dgar_last_restart_conflict = CONFLICTS;\n  return true;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 748, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1528}, "user": null, "metadata": {}}}, "error": null}
