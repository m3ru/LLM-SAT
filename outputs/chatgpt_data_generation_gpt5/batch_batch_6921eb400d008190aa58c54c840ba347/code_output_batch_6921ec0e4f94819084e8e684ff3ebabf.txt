{"id": "batch_req_6921ec2151a88190943748ca3615d416", "custom_id": "req-0001", "response": {"status_code": 200, "request_id": "09994f05c988f83686a284056d1d872d", "body": {"id": "resp_05b67a972a2721a3006921ec11ee2081919234d7dcdf018f56", "object": "response", "created_at": 1763830801, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_05b67a972a2721a3006921ec1244a081918bf33fde2b5bf150", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n  assert(solver->unassigned);\n  if (!GET_OPTION(restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Enforce minimum conflict interval between restarts\n  if (CONFLICTS < solver->limits.restart.conflicts)\n    return false;\n\n  // Dual-Threshold Adaptive Glue-Decision Restarts\n  // EWMA values\n  const double fast_glue = AVERAGE(fast_glue);\n  const double slow_glue = AVERAGE(slow_glue);\n  const double decision_rate = AVERAGE(decision_rate);\n\n  // Calculate thresholds\n  const double glue_threshold = 0.8 * slow_glue;\n  const double avg_decisions_per_conflict =\n      solver->statistics.conflicts\n          ? ((double)solver->statistics.decisions) / solver->statistics.conflicts\n          : 0.0;\n  const double decision_rate_threshold = 0.5 * avg_decisions_per_conflict;\n\n  // Static variable to avoid restarting at same conflict\n  static uint64_t last_restart_conflict = 0;\n  // Next allowed restart conflict (minimum interval)\n  static uint64_t next_restart_at = 0;\n\n  if (CONFLICTS < next_restart_at)\n    return false;\n\n  // Compute triggers\n  bool glue_trigger = (fast_glue >= glue_threshold);\n  bool decision_trigger = (decision_rate <= decision_rate_threshold);\n\n  // Tie-breaking and stable phase rules\n  bool restart = false;\n  if (solver->stable) {\n    // In stable phase, require both triggers\n    if (glue_trigger && decision_trigger)\n      restart = true;\n  } else {\n    // In non-stable, glue trigger has priority\n    if (glue_trigger)\n      restart = true;\n    else if (decision_trigger)\n      restart = true;\n  }\n\n  // Avoid two restarts at the same conflict\n  if (restart) {\n    if (CONFLICTS == last_restart_conflict) {\n      // Delay by one conflict\n      return false;\n    }\n    last_restart_conflict = CONFLICTS;\n    // Update next allowed restart conflict\n    next_restart_at = CONFLICTS + solver->limits.restart.conflicts;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 810, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 490, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1300}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec2155fc81909f8c1282453a72d7", "custom_id": "req-0002", "response": {"status_code": 200, "request_id": "da4bb46d3943c92a311ef2f39018735f", "body": {"id": "resp_0ce5cf5b30e49b25006921ec16344881a28ee134c6ddb3af02", "object": "response", "created_at": 1763830806, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0ce5cf5b30e49b25006921ec167dc081a29761b9d323670d57", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n  assert(solver->unassigned);\n  if (!GET_OPTION(restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Enforce per-conflict minimum spacing between restarts\n  static uint64_t next_restart_at = 0;\n  const uint64_t curr_conflicts = solver->statistics.conflicts;\n  const uint64_t restart_conflict_limit = solver->limits.restart.conflicts;\n\n  // If not enough conflicts have passed since the last restart, don't restart\n  if (curr_conflicts < next_restart_at)\n    return false;\n\n  // EWMA values\n  const double fast_glue = AVERAGE(fast_glue);\n  const double slow_glue = AVERAGE(slow_glue);\n  const double glue_threshold = 0.8 * slow_glue;\n\n  const double decision_rate_ewma = solver->averages[solver->stable].decision_rate.value;\n  double avg_decision_rate = 0.0;\n  if (solver->statistics.conflicts)\n    avg_decision_rate = (double)solver->statistics.decisions / (double)solver->statistics.conflicts;\n  const double decision_rate_threshold = 0.5 * avg_decision_rate;\n\n  // Triggers\n  bool glue_trigger = (fast_glue >= glue_threshold);\n  bool decision_trigger = (decision_rate_ewma <= decision_rate_threshold);\n\n  // Tie-breaking & stable phase handling\n  bool fire_restart = false;\n  if (solver->stable) {\n    // In stable phase, require both triggers\n    fire_restart = glue_trigger && decision_trigger;\n  } else {\n    // In non-stable phase, either trigger is sufficient; glue-based prioritized\n    if (glue_trigger)\n      fire_restart = true;\n    else if (decision_trigger)\n      fire_restart = true;\n  }\n\n  // If not firing, do not update next_restart_at\n  if (!fire_restart)\n    return false;\n\n  // Prevent two restarts at the same conflict\n  if (curr_conflicts == next_restart_at)\n    next_restart_at = curr_conflicts + 1;\n  else\n    next_restart_at = curr_conflicts + restart_conflict_limit;\n\n  return true;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 810, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 478, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1288}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec2154a4819092df2d4c81ebd493", "custom_id": "req-0003", "response": {"status_code": 200, "request_id": "8deb10546ead4a21303afcd631aec6da", "body": {"id": "resp_0f14605b038974b4006921ec1a3fd881a3af62d395ec05f826", "object": "response", "created_at": 1763830810, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0f14605b038974b4006921ec1a85b481a3a3fb05e124dfe1e0", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n    assert(solver->unassigned);\n    if (!GET_OPTION(restart))\n        return false;\n    if (!solver->level)\n        return false;\n\n    // Use static to persist next_restart_at across calls\n    static uint64_t next_restart_at = 0;\n    const uint64_t conflicts = solver->statistics.conflicts;\n    const uint64_t decisions = solver->statistics.decisions;\n    const uint64_t restart_conflicts = solver->limits.restart.conflicts;\n\n    // Delay restart if at same conflict as previous restart\n    if (conflicts == next_restart_at)\n        return false;\n\n    // Only consider restart if enough conflicts have passed\n    if (conflicts < next_restart_at)\n        return false;\n\n    const double fast_glue = AVERAGE(fast_glue);\n    const double slow_glue = AVERAGE(slow_glue);\n    const double glue_threshold = 0.8 * slow_glue;\n\n    // Defensive: avoid division by zero\n    double dec_per_conf = (conflicts ? ((double)decisions) / conflicts : 1.0);\n\n    const double decision_rate_ewma = solver->averages[solver->stable].decision_rate.value;\n    const double decision_threshold = 0.5 * dec_per_conf;\n\n    bool glue_trigger = (fast_glue >= glue_threshold);\n    bool decision_trigger = (decision_rate_ewma <= decision_threshold);\n\n    // In stable phase, require both triggers\n    bool restart = false;\n    if (solver->stable) {\n        restart = glue_trigger && decision_trigger;\n    } else {\n        if (glue_trigger)\n            restart = true;\n        else if (decision_trigger)\n            restart = true;\n    }\n\n    if (restart) {\n        next_restart_at = conflicts + restart_conflicts;\n        // For verbosity/debugging (optional, like in reference)\n        kissat_extremely_verbose(\n            solver,\n            \"dual-threshold restart: fast_glue=%.2f slow_glue=%.2f (threshold=%.2f/%s), \"\n            \"decision_rate=%.2f (threshold=%.2f/%s), next at %\" PRIu64,\n            fast_glue, slow_glue, glue_threshold, glue_trigger ? \"Y\" : \"N\",\n            decision_rate_ewma, decision_threshold, decision_trigger ? \"Y\" : \"N\",\n            next_restart_at\n        );\n    }\n    return restart;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 810, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 523, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1333}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec2165b48190a9c5bb8a279fc9e3", "custom_id": "req-0004", "response": {"status_code": 200, "request_id": "4c23508d15d181545356f5b5e9fd87a3", "body": {"id": "resp_076410e9eeb6204b006921ec122778819cb60d6c635b9d04d6", "object": "response", "created_at": 1763830802, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_076410e9eeb6204b006921ec127aec819cb7eb0cd31c1de46d", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Enforce minimum conflicts between restarts\n  if (CONFLICTS < solver->limits.restart.conflicts)\n    return false;\n\n  // Track next restart conflict index (initialize if first use)\n  if (solver->limits.restart.next < solver->statistics.conflicts)\n    solver->limits.restart.next = solver->statistics.conflicts + solver->limits.restart.conflicts;\n\n  // Only consider restart at or after next allowed conflict\n  if (solver->statistics.conflicts < solver->limits.restart.next)\n    return false;\n\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double glue_threshold = 0.8 * slow_glue;\n\n  const double decision_rate_ewma = AVERAGE (decision_rate);\n  // Prevent division by zero in rare case\n  double global_decision_rate = 0.0;\n  if (solver->statistics.conflicts > 0)\n    global_decision_rate = (double) solver->statistics.decisions / solver->statistics.conflicts;\n  const double decision_threshold = 0.5 * global_decision_rate;\n\n  bool glue_trigger = (fast_glue >= glue_threshold);\n  bool decision_trigger = (decision_rate_ewma <= decision_threshold);\n\n  // Tie-breaking rules:\n  // - If both triggers fire, prioritize glue-based.\n  // - If in stable phase, require both triggers.\n  // - If at same conflict as previous restart, delay by one conflict.\n\n  bool triggered = false;\n\n  if (solver->stable) {\n    if (glue_trigger && decision_trigger)\n      triggered = true;\n  } else {\n    if (glue_trigger)\n      triggered = true;\n    else if (decision_trigger)\n      triggered = true;\n  }\n\n  // Prevent restart if at same conflict as previous restart\n  static uint64_t last_restart_conflict = 0;\n  if (triggered) {\n    if (solver->statistics.conflicts == last_restart_conflict) {\n      // Delay by one conflict\n      solver->limits.restart.next = solver->statistics.conflicts + 1;\n      return false;\n    }\n    // Schedule next allowed restart\n    solver->limits.restart.next = solver->statistics.conflicts + solver->limits.restart.conflicts;\n    last_restart_conflict = solver->statistics.conflicts;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 810, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 548, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1358}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec2167a881909cc85d3e744c68f8", "custom_id": "req-0005", "response": {"status_code": 200, "request_id": "306db49774521918489ed1d269cedc32", "body": {"id": "resp_0d11b3cf467b98bd006921ec1226f081a19db897edbba8721a", "object": "response", "created_at": 1763830802, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0d11b3cf467b98bd006921ec12715881a19a96969059412464", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n  assert(solver->unassigned);\n  if (!GET_OPTION(restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  uint64_t conflicts = solver->statistics.conflicts;\n  uint64_t limit = solver->limits.restart.conflicts;\n  // Use a persistent variable for next_restart_at, stored in solver struct.\n  // If not present, add: uint64_t next_restart_at; initialized to limit.\n  if (conflicts < solver->next_restart_at)\n    return false;\n\n  // Prevent restart at same conflict as last restart\n  if (conflicts == solver->last_restart_conflict)\n    return false;\n\n  const double fast_glue = AVERAGE(fast_glue);\n  const double slow_glue = AVERAGE(slow_glue);\n  const double glue_threshold = 0.8 * slow_glue;\n\n  const double decision_rate_ewma = AVERAGE(decision_rate);\n  double avg_decisions_per_conflict = 0.0;\n  if (conflicts > 0)\n    avg_decisions_per_conflict = (double)solver->statistics.decisions / (double)conflicts;\n  const double decision_threshold = 0.5 * avg_decisions_per_conflict;\n\n  bool glue_trigger = (fast_glue >= glue_threshold);\n  bool decision_trigger = (decision_rate_ewma <= decision_threshold);\n\n  // In stable phase, require both triggers to fire.\n  bool triggered = false;\n  if (solver->stable) {\n    triggered = glue_trigger && decision_trigger;\n  } else {\n    triggered = glue_trigger || decision_trigger;\n  }\n\n  if (triggered) {\n    // Tie-break: if both fire, glue_trigger takes priority (can be used for logging, not required here)\n    solver->last_restart_conflict = conflicts;\n    solver->next_restart_at = conflicts + solver->limits.restart.conflicts;\n    return true;\n  }\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 810, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 424, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1234}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec2155488190a366c38ad5a5f52b", "custom_id": "req-0006", "response": {"status_code": 200, "request_id": "974be99dab04d8bdac58876f1afb7616", "body": {"id": "resp_0c9a56c450b03f29006921ec122664819283693200deecb42e", "object": "response", "created_at": 1763830802, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0c9a56c450b03f29006921ec1261848192a508e171f36a04ed", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Minimum conflict interval between restarts\n  const uint64_t restart_conflict_limit = solver->limits.restart.conflicts;\n\n  // Persistent variable for next allowed restart conflict\n  static uint64_t next_restart_at = 0;\n\n  // On solver reset or at startup, make sure next_restart_at is at least initial limit\n  if (next_restart_at < CONFLICTS + restart_conflict_limit)\n    next_restart_at = CONFLICTS + restart_conflict_limit;\n\n  // Enforce restart interval\n  if (CONFLICTS < next_restart_at)\n    return false;\n\n  // Gather averages and rates\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double glue_margin = 0.8 * slow_glue;\n\n  // Compute global average decision rate\n  double global_decision_rate = 0.0;\n  if (solver->statistics.conflicts > 0)\n    global_decision_rate = (double) solver->statistics.decisions / solver->statistics.conflicts;\n\n  const double decision_rate_ewma = AVERAGE (decision_rate);\n  const double decision_margin = 0.5 * global_decision_rate;\n\n  // Check triggers\n  bool glue_trigger = (fast_glue >= glue_margin);\n  bool decision_trigger = (decision_rate_ewma <= decision_margin);\n\n  // Stable phase: only restart if both triggers fire.\n  if (solver->stable) {\n    if (!(glue_trigger && decision_trigger))\n      return false;\n  } else {\n    // If neither trigger fires, no restart.\n    if (!(glue_trigger || decision_trigger))\n      return false;\n  }\n\n  // Tie-breaking: if both fire, glue takes precedence (but both result in restart).\n  // Delay: If at same conflict as previous restart, delay by one conflict.\n  static uint64_t last_restart_conflict = 0;\n  if (CONFLICTS == last_restart_conflict) {\n    next_restart_at = CONFLICTS + 1;\n    return false;\n  }\n\n  // Restart triggered, set next restart window\n  next_restart_at = CONFLICTS + restart_conflict_limit;\n  last_restart_conflict = CONFLICTS;\n\n  kissat_extremely_verbose (solver,\n      \"dual-threshold adaptive restart: \"\n      \"fast_glue=%.2f slow_glue=%.2f margin=%.2f glue_trigger=%d \"\n      \"decision_rate_ewma=%.2f global_rate=%.2f margin=%.2f decision_trigger=%d\"\n      \" (stable=%d)\",\n      fast_glue, slow_glue, glue_margin, glue_trigger,\n      decision_rate_ewma, global_decision_rate, decision_margin, decision_trigger,\n      solver->stable);\n\n  return true;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 810, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 639, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1449}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec2161fc819097aa03b7538eecba", "custom_id": "req-0007", "response": {"status_code": 200, "request_id": "58022f9e88a9e6f85e1ea698d82c6b0b", "body": {"id": "resp_0e785a4ea96ee6d0006921ec1634ec8191aeb487d453d76650", "object": "response", "created_at": 1763830806, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0e785a4ea96ee6d0006921ec166df08191a5380630bad30a9b", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n    assert(solver->unassigned);\n    if (!GET_OPTION(restart))\n        return false;\n    if (!solver->level)\n        return false;\n\n    const uint64_t conflicts = solver->statistics.conflicts;\n    const uint64_t conflict_limit = solver->limits.restart.conflicts;\n\n    // Use persistent state to track next allowed restart conflict\n    if (!solver->restart.next)\n        solver->restart.next = conflicts + conflict_limit;\n\n    // Do not restart before allowed\n    if (conflicts < solver->restart.next)\n        return false;\n\n    const double fast_glue = AVERAGE(fast_glue);\n    const double slow_glue = AVERAGE(slow_glue);\n    const double glue_threshold = 0.8 * slow_glue;\n\n    const double decision_rate_ewma = AVERAGE(decision_rate);\n    // Avoid division by zero\n    double global_decision_rate = 0.0;\n    if (solver->statistics.conflicts)\n        global_decision_rate = (double)solver->statistics.decisions / solver->statistics.conflicts;\n    const double decision_rate_threshold = 0.5 * global_decision_rate;\n\n    // See if glue-based or decision-rate-based restart triggers fire\n    const bool glue_trigger = (fast_glue >= glue_threshold);\n    const bool decision_rate_trigger = (decision_rate_ewma <= decision_rate_threshold);\n\n    // Tie-breaking/stable mode logic\n    bool restart = false;\n    if (solver->stable) {\n        // In stable: both must fire\n        if (glue_trigger && decision_rate_trigger)\n            restart = true;\n    } else {\n        // In unstable: either fires, glue prioritized for message\n        if (glue_trigger)\n            restart = true;\n        else if (decision_rate_trigger)\n            restart = true;\n    }\n\n    // Ensure we do not restart more than once at the same conflict\n    if (restart) {\n        if (solver->restart.last == conflicts) {\n            // Already restarted at this conflict, delay one\n            solver->restart.next = conflicts + 1;\n            return false;\n        }\n        solver->restart.last = conflicts;\n        solver->restart.next = conflicts + conflict_limit;\n    }\n\n    // Optionally, print verbose info\n    if (restart) {\n        if (glue_trigger)\n            kissat_extremely_verbose(solver,\n                \"restart: glue_trigger %.2f >= %.2f (0.8 * %.2f)\",\n                fast_glue, glue_threshold, slow_glue);\n        else if (decision_rate_trigger)\n            kissat_extremely_verbose(solver,\n                \"restart: decision_rate_trigger %.2f <= %.2f (0.5 * %.2f)\",\n                decision_rate_ewma, decision_rate_threshold, global_decision_rate);\n    }\n\n    return restart;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 810, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 605, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1415}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec21528c81909231f0fd54feee14", "custom_id": "req-0008", "response": {"status_code": 200, "request_id": "6a42c96a872fd879857cb12b254a3d74", "body": {"id": "resp_0d9fed2638379cef006921ec16ab94819f96140f6b1530daf5", "object": "response", "created_at": 1763830806, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0d9fed2638379cef006921ec16f9c4819fa7d6baa3135518cd", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n  assert(solver->unassigned);\n  if (!GET_OPTION(restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Retrieve necessary statistics and values\n  const uint64_t conflicts = solver->statistics.conflicts;\n  const uint64_t decisions = solver->statistics.decisions;\n  const uint64_t restart_conflict_limit = solver->limits.restart.conflicts;\n\n  // Maintain static variable for next allowed restart\n  static uint64_t next_restart_at = 0;\n  static uint64_t last_restart_at = 0;\n\n  // Initialize on first call or after a restart window\n  if (next_restart_at == 0)\n    next_restart_at = conflicts + restart_conflict_limit;\n\n  // Enforce minimum distance between restarts\n  if (conflicts < next_restart_at)\n    return false;\n\n  // Extract moving averages\n  const double fast_glue = AVERAGE(fast_glue);\n  const double slow_glue = AVERAGE(slow_glue);\n  const double decision_rate = AVERAGE(decision_rate);\n\n  // Compute long-term average decision rate\n  double avg_decision_rate = 0.0;\n  if (conflicts > 0)\n    avg_decision_rate = (double)decisions / (double)conflicts;\n  else\n    avg_decision_rate = 0.0;\n\n  // Dual-threshold triggers\n  const bool glue_trigger = (fast_glue >= 0.8 * slow_glue);\n  const bool decision_trigger = (decision_rate <= 0.5 * avg_decision_rate);\n\n  // Tie-breaking: glue has priority\n  bool restart = false;\n\n  if (solver->stable) {\n    // In stable, only restart if both triggers fire\n    if (glue_trigger && decision_trigger)\n      restart = true;\n  } else {\n    // Otherwise, restart if either trigger fires\n    if (glue_trigger)\n      restart = true;\n    else if (decision_trigger)\n      restart = true;\n  }\n\n  // If at same conflict as previous restart, delay by one conflict\n  if (restart && conflicts == last_restart_at)\n    return false;\n\n  if (restart) {\n    // Update the next allowed restart conflict and last restart conflict\n    last_restart_at = conflicts;\n    next_restart_at = conflicts + restart_conflict_limit;\n\n    // Logging for debug/trace\n    kissat_extremely_verbose(\n      solver,\n      \"dual-threshold restart at conflict %\" PRIu64\n      \": fast_glue=%.2f, slow_glue=%.2f (trigger:%d), \"\n      \"decision_rate=%.2f, avg_decision_rate=%.2f (trigger:%d), \"\n      \"stable=%d\",\n      conflicts, fast_glue, slow_glue, glue_trigger,\n      decision_rate, avg_decision_rate, decision_trigger,\n      solver->stable);\n\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 810, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 633, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1443}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec2155c88190817a7d686519ec92", "custom_id": "req-0009", "response": {"status_code": 200, "request_id": "521d08e21d861bcec74e6c8d0e73e462", "body": {"id": "resp_0ff70e5166ef8c33006921ec17748c8191b10c410c82c9f1bd", "object": "response", "created_at": 1763830807, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0ff70e5166ef8c33006921ec17f0688191b63272240f756d88", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n  uint64_t conflicts = CONFLICTS;\n  uint64_t restart_conflict_limit = solver->limits.restart.conflicts;\n\n  // Static memory for next restart conflict (persistent between calls)\n  static uint64_t next_restart_at = 0;\n  static uint64_t last_restart_conflict = 0;\n\n  // On first invocation, set next_restart_at\n  if (next_restart_at == 0)\n    next_restart_at = conflicts + restart_conflict_limit;\n\n  // Delay restart if called at same conflict as previous restart\n  if (conflicts == last_restart_conflict)\n    return false;\n\n  if (conflicts < next_restart_at)\n    return false;\n\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double glue_threshold = 0.8 * slow_glue;\n\n  // Compute decision rate EWMA and global decision rate\n  const double decision_rate_ewma = AVERAGE (decision_rate);\n  double global_decision_rate = 0.0;\n  if (conflicts > 0)\n    global_decision_rate = (double) solver->statistics.decisions / conflicts;\n  const double decision_rate_threshold = 0.5 * global_decision_rate;\n\n  bool glue_trigger = (fast_glue >= glue_threshold);\n  bool decision_rate_trigger = (decision_rate_ewma <= decision_rate_threshold);\n\n  bool restart = false;\n\n  if (solver->stable) {\n    // In stable phase, require both triggers\n    if (glue_trigger && decision_rate_trigger)\n      restart = true;\n  } else {\n    // In non-stable, fire if either triggers, glue has priority\n    if (glue_trigger)\n      restart = true;\n    else if (decision_rate_trigger)\n      restart = true;\n  }\n\n  if (restart) {\n    // Set up next restart limit and record conflict\n    last_restart_conflict = conflicts;\n    next_restart_at = conflicts + restart_conflict_limit;\n\n    kissat_extremely_verbose (solver,\n      \"dual-threshold adaptive restart at conflict %\" PRIu64\n      \": fast_glue=%g slow_glue=%g (%.2f), glue_trigger=%d, \"\n      \"decision_rate_ewma=%g global_decision_rate=%g (%.2f), decision_rate_trigger=%d, next restart at %\" PRIu64,\n      conflicts, fast_glue, glue_threshold, glue_trigger,\n      decision_rate_ewma, global_decision_rate, decision_rate_threshold, decision_rate_trigger,\n      next_restart_at);\n\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 810, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 600, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1410}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec2150708190a67e7470ebf3c027", "custom_id": "req-0010", "response": {"status_code": 200, "request_id": "f721c007782992fce3adee0e25764e13", "body": {"id": "resp_0875a782700c6cd2006921ec1b573c819fa323ea38a344f93b", "object": "response", "created_at": 1763830811, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0875a782700c6cd2006921ec1be2e4819fb79385ab22eda0a0", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n  assert(solver->unassigned);\n  if (!GET_OPTION(restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Conflict budget: only allow restart if conflict count >= next allowed restart\n  if (CONFLICTS < solver->limits.restart.conflicts)\n    return false;\n\n  // EWMA values for glue and decision rate\n  const double fast_glue = AVERAGE(fast_glue);\n  const double slow_glue = AVERAGE(slow_glue);\n  const double decision_rate_ewma = AVERAGE(decision_rate);\n  const double global_decision_rate = solver->statistics.conflicts\n      ? ((double)solver->statistics.decisions / (double)solver->statistics.conflicts)\n      : 0.0;\n\n  // Compute glue and decision triggers\n  const double glue_threshold = 0.8 * slow_glue;\n  const double decision_threshold = 0.5 * global_decision_rate;\n\n  const bool glue_trigger = (fast_glue >= glue_threshold);\n  const bool decision_trigger = (decision_rate_ewma <= decision_threshold);\n\n  // In stable phase, only restart if BOTH triggers fire\n  bool restart = false;\n  if (solver->stable) {\n    restart = glue_trigger && decision_trigger;\n  } else {\n    restart = glue_trigger || decision_trigger;\n  }\n\n  // Tie-breaking: glue-based trigger takes precedence if both fire (for logging/extreme verbosity)\n  char trigger_cause = '-';\n  if (restart) {\n    if (glue_trigger)\n      trigger_cause = 'G'; // glue-based\n    else if (decision_trigger)\n      trigger_cause = 'D'; // decision-rate\n  }\n\n  // If at same conflict as previous restart, delay one conflict\n  static uint64_t last_restart_conflict = 0;\n  if (restart) {\n    if (last_restart_conflict == solver->statistics.conflicts) {\n      restart = false;\n    }\n  }\n\n  kissat_extremely_verbose(\n      solver,\n      \"dual-threshold adaptive: \"\n      \"fast_glue %.2f (>= %.2f?), slow_glue %.2f, \"\n      \"decision_rate %.2f (<= %.2f?), global_decision_rate %.2f, \"\n      \"stable %d, glue_trigger %d, decision_trigger %d, restart %d, cause %c\",\n      fast_glue, glue_threshold, slow_glue,\n      decision_rate_ewma, decision_threshold, global_decision_rate,\n      solver->stable, glue_trigger, decision_trigger, restart, trigger_cause);\n\n  // If restart, set next restart conflict limit\n  if (restart) {\n    last_restart_conflict = solver->statistics.conflicts;\n    solver->limits.restart.conflicts = solver->statistics.conflicts + GET_OPTION(restartint);\n  }\n  return restart;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 810, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 618, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1428}, "user": null, "metadata": {}}}, "error": null}
