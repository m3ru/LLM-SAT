{"id": "batch_req_6921ec7060ac8190b982b86f8ca8920b", "custom_id": "req-0001", "response": {"status_code": 200, "request_id": "ebfe47b6ee347f6af0a2c99290af74ca", "body": {"id": "resp_0108b0b4c4eaf16b006921ec542c308190bc7c566adb803d97", "object": "response", "created_at": 1763830868, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0108b0b4c4eaf16b006921ec546d888190902addd505affa00", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n  assert(solver->unassigned);\n\n  if (!GET_OPTION(restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Hard conflict limit: always allow restart if conflict limit reached\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Gather relevant statistics\n  const double fast_glue = AVERAGE(fast_glue);\n  const double slow_glue = AVERAGE(slow_glue);\n  const double decision_rate = AVERAGE(decision_rate);\n\n  // Static thresholds\n  const double glue_ratio_threshold = 1.2;\n  const double decision_rate_drop_threshold = 0.7;\n\n  // Compute glue ratio (protect against division by zero)\n  const double glue_ratio = fast_glue / (slow_glue > 1e-6 ? slow_glue : 1.0);\n\n  // Decision rate baseline: store in solver->restart_decision_rate_baseline\n  // (We assume this is correctly initialized and updated elsewhere in the code,\n  // as creating new persistent storage is not part of this function.)\n  double baseline = solver->restart_decision_rate_baseline;\n\n  // If baseline is not positive, initialize it to current decision rate\n  if (baseline <= 0.0)\n    baseline = decision_rate > 0.0 ? decision_rate : 1.0;\n\n  // Compute decision rate drop ratio\n  const double decision_rate_drop = decision_rate / (baseline > 1e-9 ? baseline : 1.0);\n\n  // Evaluate restart condition\n  bool trigger_restart = false;\n  bool glue_reason = false;\n\n  if (!solver->stable) {\n    // Non-stable stage: restart if glue ratio or decision rate drop triggers\n    if (glue_ratio > glue_ratio_threshold) {\n      trigger_restart = true;\n      glue_reason = true;\n    } else if (decision_rate_drop < decision_rate_drop_threshold) {\n      trigger_restart = true;\n      glue_reason = false;\n    }\n  } else {\n    // Stable stage: restart only if both triggers fire\n    if (glue_ratio > glue_ratio_threshold && decision_rate_drop < decision_rate_drop_threshold) {\n      trigger_restart = true;\n      glue_reason = true;\n    }\n  }\n\n  // Logging (extremely verbose)\n  kissat_extremely_verbose(\n    solver,\n    \"AGDHR: glue_ratio=%.3f (thresh=%.2f) decision_rate_drop=%.3f (thresh=%.2f) baseline=%.3f %s stage=%s\",\n    glue_ratio, glue_ratio_threshold,\n    decision_rate_drop, decision_rate_drop_threshold,\n    baseline,\n    trigger_restart ? (glue_reason ? \"[GLUE]\" : \"[DECISION]\") : \"\",\n    solver->stable ? \"stable\" : \"focused\"\n  );\n\n  // If restarting, reset the baseline for the next round\n  if (trigger_restart) {\n    solver->restart_decision_rate_baseline = decision_rate > 0.0 ? decision_rate : 1.0;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 668, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2115}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec7067f88190bd1bf6c6a04cdb0a", "custom_id": "req-0002", "response": {"status_code": 200, "request_id": "587b1cb842d55af8b70b3c7622f42498", "body": {"id": "resp_0b912727aaa416c1006921ec17942c819696f53db85eaaf91a", "object": "response", "created_at": 1763830807, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0b912727aaa416c1006921ec17db3c8196b785d8443b8e5875", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Hard limit: always restart if conflicts >= limit\n  if (CONFLICTS >= solver->limits.restart.conflicts) {\n    solver->decision_rate_baseline = AVERAGE (decision_rate);\n    kissat_extremely_verbose (\n      solver,\n      \"AGDHR: hard conflict limit reached (%\" PRIu64 \" >= %\" PRIu64 \"), restarting\",\n      CONFLICTS, solver->limits.restart.conflicts);\n    return true;\n  }\n\n  // AGDHR thresholds\n  const double glue_ratio_threshold = 1.2;\n  const double decision_rate_drop_threshold = 0.7;\n\n  // Compute glue ratio: R_g = fast_glue / max(1, slow_glue)\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double denom = slow_glue < 1.0 ? 1.0 : slow_glue;\n  const double glue_ratio = fast_glue / denom;\n\n  // Compute decision rate drop: R_d = decision_rate / decision_rate_baseline\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // If baseline has not been initialized (startup), set it to current\n  if (solver->decision_rate_baseline == 0.0)\n    solver->decision_rate_baseline = decision_rate;\n\n  const double decision_rate_drop =\n    solver->decision_rate_baseline > 0.0\n      ? decision_rate / solver->decision_rate_baseline\n      : 1.0; // default to 1 if uninitialized\n\n  // Logging for debugging\n  kissat_extremely_verbose (\n    solver,\n    \"AGDHR: glue_ratio %.3f (threshold %.2f), decision_rate_drop %.3f (threshold %.2f), baseline %.3f\",\n    glue_ratio, glue_ratio_threshold, decision_rate_drop, decision_rate_drop_threshold, solver->decision_rate_baseline);\n\n  bool restart = false;\n  bool glue_reason = false;\n  if (!solver->stable) {\n    // Non-stable: restart if glue_ratio > T_g OR decision_rate_drop < T_d\n    if (glue_ratio > glue_ratio_threshold) {\n      restart = true;\n      glue_reason = true;\n    }\n    if (decision_rate_drop < decision_rate_drop_threshold) {\n      restart = true;\n      if (!glue_reason) glue_reason = false;\n    }\n  } else {\n    // Stable: restart if glue_ratio > T_g AND decision_rate_drop < T_d\n    if (glue_ratio > glue_ratio_threshold && decision_rate_drop < decision_rate_drop_threshold) {\n      restart = true;\n      glue_reason = true; // tie-breaker: glue takes precedence\n    }\n  }\n\n  if (restart) {\n    solver->decision_rate_baseline = decision_rate;\n    kissat_extremely_verbose (\n      solver,\n      \"AGDHR: restarting due to %s trigger (glue_ratio %.3f, decision_rate_drop %.3f)\",\n      glue_reason ? \"glue\" : \"decision_rate\",\n      glue_ratio, decision_rate_drop\n    );\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 712, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2159}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec70631c81909dfb115d514ea717", "custom_id": "req-0003", "response": {"status_code": 200, "request_id": "cfde852c149e236ed8cf9864230c2a9b", "body": {"id": "resp_0c902110398daedc006921ec53a6a081938cbe305aa2f7792d", "object": "response", "created_at": 1763830867, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0c902110398daedc006921ec53f7788193b3a9538cf8f98ab4", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n\n  // Option check\n  if (!GET_OPTION (restart))\n    return false;\n\n  // Do not restart at root level\n  if (!solver->level)\n    return false;\n\n  // Hard limit: always restart if enough conflicts (satisfies Algorithm 5)\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n  {\n    kissat_extremely_verbose (solver, \"restart: conflict hard limit triggered (%\" PRIu64 \" >= %\" PRIu64 \")\", CONFLICTS, solver->limits.restart.conflicts);\n    // AGDHR 6: reset decision_rate_baseline to current rate\n    solver->decision_rate_baseline = solver->averages[solver->stable].decision_rate.value;\n    return true;\n  }\n\n  // Get relevant statistics\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = solver->averages[solver->stable].decision_rate.value;\n\n  // Algorithm 1a: Glue Ratio\n  const double glue_ratio = fast_glue / (slow_glue > 1e-9 ? slow_glue : 1.0);\n\n  // Algorithm 1b: Decision Rate Drop\n  double baseline = solver->decision_rate_baseline;\n  if (baseline < 1e-9)\n    baseline = decision_rate > 1e-9 ? decision_rate : 1.0;\n  const double decision_rate_drop = decision_rate / baseline;\n\n  // Algorithm 2: Thresholds\n  const double GLUE_RATIO_THRESHOLD = 1.2;\n  const double DECISION_RATE_DROP_THRESHOLD = 0.7;\n\n  // Algorithm 3: Restart triggers\n  bool glue_trigger = (glue_ratio > GLUE_RATIO_THRESHOLD);\n  bool dec_trigger = (decision_rate_drop < DECISION_RATE_DROP_THRESHOLD);\n\n  bool restart = false;\n  if (!solver->stable)\n    restart = glue_trigger || dec_trigger;\n  else\n    restart = glue_trigger && dec_trigger;\n\n  if (restart)\n  {\n    // Algorithm 4: Tie-breaker logging\n    if (glue_trigger && dec_trigger)\n      kissat_extremely_verbose (solver, \"restart: AGDHR (glue ratio %.2f > %.2f AND decision rate %.2f < %.2f) [glue primary]\", glue_ratio, GLUE_RATIO_THRESHOLD, decision_rate_drop, DECISION_RATE_DROP_THRESHOLD);\n    else if (glue_trigger)\n      kissat_extremely_verbose (solver, \"restart: AGDHR (glue ratio %.2f > %.2f)\", glue_ratio, GLUE_RATIO_THRESHOLD);\n    else\n      kissat_extremely_verbose (solver, \"restart: AGDHR (decision rate %.2f < %.2f)\", decision_rate_drop, DECISION_RATE_DROP_THRESHOLD);\n\n    // AGDHR 6: reset decision_rate_baseline to current rate\n    solver->decision_rate_baseline = decision_rate;\n    return true;\n  }\n\n  // No restart\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 666, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2113}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec70613081908a633ebefee347b8", "custom_id": "req-0004", "response": {"status_code": 200, "request_id": "c97864d69c7d80052c73b938ada502a7", "body": {"id": "resp_09787ae7408adde0006921ec53bc308193bc2cf5834960f7c7", "object": "response", "created_at": 1763830867, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_09787ae7408adde0006921ec540e488193ba177c69fa044df9", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n\n  if (!solver->level)\n    return false;\n\n  // Hard limit on conflicts\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n  {\n    solver->decision_rate_baseline = solver->averages[solver->stable].decision_rate.value;\n    kissat_extremely_verbose (solver,\n      \"hard conflict limit %ld reached, restart forced\",\n      solver->limits.restart.conflicts);\n    return true;\n  }\n\n  // Compute glue ratio\n  const double fast_glue = solver->averages[solver->stable].fast_glue.value;\n  const double slow_glue = solver->averages[solver->stable].slow_glue.value;\n  const double glue_ratio = fast_glue / (slow_glue < 1.0 ? 1.0 : slow_glue);\n\n  // Decision rate and baseline management\n  double decision_rate = solver->averages[solver->stable].decision_rate.value;\n\n  // Use the following static variables to maintain decision_rate_baseline\n  // (If not already present in struct, add to solver struct: double decision_rate_baseline;)\n  // We update every 100 conflicts, keeping the highest value in a window of 1000 conflicts\n  if (!solver->decision_rate_baseline)\n    solver->decision_rate_baseline = decision_rate;\n\n  static const unsigned window = 1000;\n  static const unsigned update_period = 100;\n\n  if ((CONFLICTS % update_period) == 0)\n  {\n    if (decision_rate > solver->decision_rate_baseline)\n      solver->decision_rate_baseline = decision_rate;\n    // Optionally, decay to avoid stale baseline if window passed\n    if ((CONFLICTS % window) == 0)\n      solver->decision_rate_baseline = decision_rate;\n  }\n\n  double decision_rate_ratio = decision_rate / (solver->decision_rate_baseline < 1e-12 ? 1.0 : solver->decision_rate_baseline);\n\n  // Thresholds\n  const double glue_ratio_threshold = 1.2;\n  const double decision_rate_drop_threshold = 0.7;\n\n  bool glue_ratio_trigger = glue_ratio > glue_ratio_threshold;\n  bool decision_rate_trigger = decision_rate_ratio < decision_rate_drop_threshold;\n\n  // AGDHR logic\n  bool restart = false;\n  if (!solver->stable)\n  {\n    // Non-stable: aggressive\n    if (glue_ratio_trigger || decision_rate_trigger)\n      restart = true;\n  }\n  else\n  {\n    // Stable: conservative\n    if (glue_ratio_trigger && decision_rate_trigger)\n      restart = true;\n  }\n\n  if (restart)\n  {\n    // Tie-breaker logging\n    const char *reason = (glue_ratio_trigger ? \"glue-ratio\" : \"decision-rate\");\n    kissat_extremely_verbose (solver,\n      \"AGDHR restart: %s triggered (fast_glue=%.2f, slow_glue=%.2f, glue_ratio=%.2f [th=%.2f], decision_rate=%.6f, baseline=%.6f, ratio=%.3f [th=%.2f])%s\",\n      reason,\n      fast_glue, slow_glue, glue_ratio, glue_ratio_threshold,\n      decision_rate, solver->decision_rate_baseline, decision_rate_ratio, decision_rate_drop_threshold,\n      solver->stable ? \" [stable]\" : \" [focused]\"\n    );\n    // After each restart, reset decision_rate_baseline to current decision rate\n    solver->decision_rate_baseline = decision_rate;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 789, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2236}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec7069108190b49d17ea5667e867", "custom_id": "req-0005", "response": {"status_code": 200, "request_id": "4b7a6cddff9b97c7cb6cca91f1bb428c", "body": {"id": "resp_0673c5020d312c4d006921ec18200c8195a589a7e289c23a58", "object": "response", "created_at": 1763830808, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0673c5020d312c4d006921ec187bf88195984710881065a946", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Hard conflict limit: always restart if reached\n  if (CONFLICTS >= solver->limits.restart.conflicts) {\n    // For AGDHR, after restart: reset baseline\n    solver->decision_rate_baseline = solver->averages[solver->stable].decision_rate.value;\n    kissat_extremely_verbose (solver,\n        \"restart: hard conflict limit %ld reached, baseline reset to %g\",\n        solver->limits.restart.conflicts, solver->decision_rate_baseline);\n    return true;\n  }\n\n  const double fast_glue = solver->averages[solver->stable].fast_glue.value;\n  const double slow_glue = solver->averages[solver->stable].slow_glue.value;\n  const double decision_rate = solver->averages[solver->stable].decision_rate.value;\n\n  // Setup baseline for decision rate if not yet initialized (first call)\n  if (solver->decision_rate_baseline < 1e-12) // treat as zero\n    solver->decision_rate_baseline = decision_rate;\n\n  // Maintain a sliding-window maximum baseline (updated every 100 conflicts)\n  if ((CONFLICTS % 100) == 0) {\n    if (decision_rate > solver->decision_rate_baseline)\n      solver->decision_rate_baseline = decision_rate;\n    // (else: keep current baseline)\n  }\n\n  // AGDHR: Compute triggers\n  const double glue_ratio = fast_glue / (slow_glue > 1e-6 ? slow_glue : 1.0);\n  const double glue_ratio_threshold = 1.2;\n  const double decision_rate_drop = decision_rate / (solver->decision_rate_baseline > 1e-12 ? solver->decision_rate_baseline : 1.0);\n  const double decision_rate_drop_threshold = 0.7;\n\n  bool glue_trigger = glue_ratio > glue_ratio_threshold;\n  bool dec_rate_trigger = decision_rate_drop < decision_rate_drop_threshold;\n  bool restart = false;\n  char reason[32] = \"\";\n\n  if (!solver->stable) {\n    // Unstable: restart if either trigger\n    if (glue_trigger || dec_rate_trigger) {\n      restart = true;\n      if (glue_trigger && dec_rate_trigger)\n        snprintf(reason, sizeof(reason), \"glue+dec-rate\");\n      else if (glue_trigger)\n        snprintf(reason, sizeof(reason), \"glue\");\n      else\n        snprintf(reason, sizeof(reason), \"dec-rate\");\n    }\n  } else {\n    // Stable: restart only if both triggers\n    if (glue_trigger && dec_rate_trigger) {\n      restart = true;\n      snprintf(reason, sizeof(reason), \"glue+dec-rate\");\n    }\n  }\n\n  if (restart) {\n    // Reset baseline after restart\n    solver->decision_rate_baseline = decision_rate;\n    kissat_extremely_verbose (solver,\n        \"restart: AGDHR triggered (%s), \"\n        \"glue_ratio %g (thr %.2f), dec_rate_drop %g (thr %.2f), \"\n        \"baseline reset to %g\",\n        reason, glue_ratio, glue_ratio_threshold,\n        decision_rate_drop, decision_rate_drop_threshold,\n        solver->decision_rate_baseline);\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 732, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2179}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec7062d48190bc5919f99d8434a4", "custom_id": "req-0006", "response": {"status_code": 200, "request_id": "2972cecde680fcfeada6080ede55b0dd", "body": {"id": "resp_019916ef68612899006921ec20694481969961d68a8d374d97", "object": "response", "created_at": 1763830816, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_019916ef68612899006921ec2119ec8196a5d68eb9a8ef52d7", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n  assert(solver->unassigned);\n\n  if (!GET_OPTION(restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Hard conflict limit (triggers restart regardless of heuristics)\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Compute fast and slow glue averages\n  const double fast_glue = AVERAGE(fast_glue);\n  const double slow_glue = AVERAGE(slow_glue);\n\n  // Compute glue ratio\n  const double glue_ratio = fast_glue / (slow_glue > 1e-12 ? slow_glue : 1.0);\n\n  // Compute decision rate and baseline\n  const double decision_rate = AVERAGE(decision_rate);\n\n  // Persistent storage for baseline (static keeps it per process, but in Kissat's context, per solver* is wanted)\n  // We use the solver->restart_decision_rate_baseline field (must be declared in solver struct).\n  // If not present, can use solver->restart_glue_limit as a hack for storage, but better to declare a new double field.\n  if (!solver->restart_decision_rate_baseline_init) {\n    solver->restart_decision_rate_baseline = decision_rate;\n    solver->restart_decision_rate_baseline_init = true;\n  }\n\n  double baseline = solver->restart_decision_rate_baseline;\n  // If decision rate exceeds baseline, update baseline upward\n  if (decision_rate > baseline)\n    solver->restart_decision_rate_baseline = decision_rate;\n\n  // Compute decision rate drop ratio\n  const double decision_rate_drop = (baseline > 1e-12) ? (decision_rate / baseline) : 1.0;\n\n  // Thresholds\n  const double GLUE_RATIO_THRESHOLD = 1.2;\n  const double DECISION_RATE_DROP_THRESHOLD = 0.7;\n\n  bool glue_trigger = (glue_ratio > GLUE_RATIO_THRESHOLD);\n  bool rate_trigger = (decision_rate_drop < DECISION_RATE_DROP_THRESHOLD);\n\n  // Logging for tie-breaker reason\n  const char *reason = 0;\n\n  bool restart = false;\n  if (!solver->stable) {\n    // Non-stable: restart if EITHER glue or rate triggers\n    if (glue_trigger || rate_trigger) {\n      restart = true;\n      if (glue_trigger && rate_trigger)\n        reason = \"glue-ratio-and-decision-rate\";\n      else if (glue_trigger)\n        reason = \"glue-ratio\";\n      else\n        reason = \"decision-rate\";\n    }\n  } else {\n    // Stable: restart only if BOTH triggers\n    if (glue_trigger && rate_trigger) {\n      restart = true;\n      reason = \"glue-ratio-and-decision-rate\";\n    }\n  }\n\n  if (restart) {\n    // After each restart, reset baseline to current decision rate\n    solver->restart_decision_rate_baseline = decision_rate;\n    // Optionally, print logging for debugging\n    kissat_extremely_verbose(\n      solver,\n      \"restarting (%s): glue_ratio=%.3f (fast=%.3f, slow=%.3f, thr=%.2f) \"\n      \"decision_rate=%.3f/baseline=%.3f (drop=%.3f, thr=%.2f)\",\n      reason ? reason : \"conflict-limit\",\n      glue_ratio, fast_glue, slow_glue, GLUE_RATIO_THRESHOLD,\n      decision_rate, baseline, decision_rate_drop, DECISION_RATE_DROP_THRESHOLD\n    );\n  }\n\n  return restart;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 769, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2216}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec7068b481909e11bd2b59be66b0", "custom_id": "req-0007", "response": {"status_code": 200, "request_id": "d367bf7866e96cd0e2ac4643cec1570a", "body": {"id": "resp_09f19b0060dbd8e6006921ec28ad2c8197a05ea6bcd5a0e490", "object": "response", "created_at": 1763830824, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_09f19b0060dbd8e6006921ec28e8008197973f534e7ab47c75", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n  assert(solver->unassigned);\n\n  if (!GET_OPTION(restart))\n    return false;\n\n  if (!solver->level)\n    return false;\n\n  if (CONFLICTS >= solver->limits.restart.conflicts) {\n    // Hard limit: always restart\n    // Reset decision rate baseline after restart\n    solver->decision_rate_baseline = solver->averages[solver->stable].decision_rate.value;\n    kissat_extremely_verbose(\n      solver,\n      \"hard restart: conflicts (%\" PRIu64 \") >= limit (%\" PRIu64 \")\",\n      CONFLICTS, solver->limits.restart.conflicts\n    );\n    return true;\n  }\n\n  // Get fast and slow glue averages\n  const double fast_glue = AVERAGE(fast_glue);\n  const double slow_glue = AVERAGE(slow_glue);\n\n  // Avoid division by zero\n  const double denom_glue = slow_glue > 0.0 ? slow_glue : 1.0;\n  const double glue_ratio = fast_glue / denom_glue;\n\n  // Get current decision rate\n  const double decision_rate = AVERAGE(decision_rate);\n\n  // Retrieve and update decision_rate_baseline\n  double baseline = solver->decision_rate_baseline;\n  if (baseline < decision_rate)\n    solver->decision_rate_baseline = decision_rate; // Track max over window\n  baseline = solver->decision_rate_baseline;\n\n  // Compute decision rate drop ratio\n  const double decision_rate_ratio = baseline > 0.0 ? (decision_rate / baseline) : 1.0;\n\n  // Thresholds\n  const double glue_threshold = 1.2;\n  const double decision_threshold = 0.7;\n\n  bool trigger_glue = glue_ratio > glue_threshold;\n  bool trigger_decision = decision_rate_ratio < decision_threshold;\n\n  bool restart = false;\n  if (!solver->stable) {\n    // Non-stable: restart if either trigger\n    if (trigger_glue || trigger_decision)\n      restart = true;\n  } else {\n    // Stable: restart only if both triggers\n    if (trigger_glue && trigger_decision)\n      restart = true;\n  }\n\n  if (restart) {\n    // Tie-breaker primary reason (for logging/statistics)\n    if (trigger_glue)\n      kissat_extremely_verbose(\n        solver,\n        \"AGDHR restart: glue ratio %.3f (fast %.3f / slow %.3f) > %.2f, decision rate %.3f (baseline %.3f, ratio %.3f)\",\n        glue_ratio, fast_glue, slow_glue, glue_threshold,\n        decision_rate, baseline, decision_rate_ratio\n      );\n    else\n      kissat_extremely_verbose(\n        solver,\n        \"AGDHR restart: decision rate drop %.3f < %.2f (current %.3f, baseline %.3f), glue ratio %.3f\",\n        decision_rate_ratio, decision_threshold,\n        decision_rate, baseline, glue_ratio\n      );\n    // After restart, reset baseline to current\n    solver->decision_rate_baseline = decision_rate;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 678, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2125}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec70665c8190add9396a26fb418e", "custom_id": "req-0008", "response": {"status_code": 200, "request_id": "f5c661d7b5ececa2fd004ab24ee92aee", "body": {"id": "resp_074746ff3052f000006921ec303b1c8196948889f9abd2620d", "object": "response", "created_at": 1763830832, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_074746ff3052f000006921ec3088948196b49792dc2e37c70e", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n\n  if (!solver->level)\n    return false;\n\n  // Always restart if hard conflict limit reached\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Compute averages\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // --- AGDHR: Maintain and update decision_rate_baseline in solver struct ---\n  // We'll use solver->restart_decision_rate_baseline, a double field.\n  // If not initialized, initialize to current decision_rate.\n  if (solver->restart_decision_rate_baseline <= 0.0)\n    solver->restart_decision_rate_baseline = decision_rate;\n\n  // Use a counter to track when to update the baseline every 100 conflicts\n  // (assuming solver->restart_baseline_update_counter exists and initialized to 0)\n  solver->restart_baseline_update_counter++;\n  if (solver->restart_baseline_update_counter >= 100) {\n    // Find the max decision_rate in the last 1000 conflicts (window)\n    // For simplicity, we'll just update baseline to max(current baseline, current rate)\n    // (In a production version, you'd use a buffer or more precise tracking)\n    if (decision_rate > solver->restart_decision_rate_baseline)\n      solver->restart_decision_rate_baseline = decision_rate;\n    solver->restart_baseline_update_counter = 0;\n  }\n\n  // Compute ratios for AGDHR\n  const double glue_ratio = fast_glue / (slow_glue > 1e-9 ? slow_glue : 1.0);\n  const double decision_rate_drop =\n      (solver->restart_decision_rate_baseline > 1e-9)\n      ? (decision_rate / solver->restart_decision_rate_baseline)\n      : 1.0;\n\n  // Thresholds\n  const double glue_ratio_threshold = 1.2;\n  const double decision_rate_drop_threshold = 0.7;\n\n  // Tie-break reason (for logging/statistics)\n  const bool glue_trigger = glue_ratio > glue_ratio_threshold;\n  const bool decision_trigger = decision_rate_drop < decision_rate_drop_threshold;\n\n  bool restart = false;\n\n  if (!solver->stable) {\n    // Non-stable: restart if either trigger is hit\n    if (glue_trigger || decision_trigger)\n      restart = true;\n  } else {\n    // Stable: restart only if both triggers are hit\n    if (glue_trigger && decision_trigger)\n      restart = true;\n  }\n\n  if (restart) {\n    kissat_extremely_verbose (\n      solver,\n      \"AGDHR restart: stage=%s glue_ratio=%.2f(dec=%.2f/%.2f) T_g=%.2f, \"\n      \"decision_rate_drop=%.2f(dec=%.2f/base=%.2f) T_d=%.2f, reason=%s\",\n      solver->stable ? \"stable\" : \"unstable\",\n      glue_ratio, fast_glue, slow_glue, glue_ratio_threshold,\n      decision_rate_drop, decision_rate, solver->restart_decision_rate_baseline, decision_rate_drop_threshold,\n      glue_trigger ? \"glue\" : (decision_trigger ? \"decision\" : \"none\")\n    );\n    // Reset baseline on restart\n    solver->restart_decision_rate_baseline = decision_rate;\n    solver->restart_baseline_update_counter = 0;\n  }\n\n  return restart;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 777, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2224}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec706cb88190a43e42168c39c680", "custom_id": "req-0009", "response": {"status_code": 200, "request_id": "ac6366c72c7f3f500b81d8e70576bfcf", "body": {"id": "resp_0b6a717bb943bf00006921ec3822c08193bda93aaeed6aa6a0", "object": "response", "created_at": 1763830840, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0b6a717bb943bf00006921ec38aa008193b9545467a0a67d4f", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Hard conflict limit (always triggers restart)\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Get glue averages\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n\n  // Compute glue ratio\n  const double glue_ratio = fast_glue / (slow_glue > 1e-12 ? slow_glue : 1.0);\n\n  // Decision rate and baseline\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // \"decision_rate_baseline\" is a new field presumed in the solver struct,\n  // must be maintained elsewhere (e.g. update every 100 conflicts to max over last 1000).\n  // For this code, we assume it is available as solver->decision_rate_baseline.\n  const double baseline = solver->decision_rate_baseline > 1e-12 ? solver->decision_rate_baseline : 1.0;\n  const double decision_rate_drop = decision_rate / baseline;\n\n  // Thresholds\n  const double glue_ratio_threshold = 1.2;\n  const double decision_rate_drop_threshold = 0.7;\n\n  // Stage\n  const bool stable = solver->stable;\n\n  // Logging for tie-breaker\n  bool glue_trigger = (glue_ratio > glue_ratio_threshold);\n  bool decision_trigger = (decision_rate_drop < decision_rate_drop_threshold);\n  bool restart = false;\n\n  if (!stable) {\n    // Unstable: restart if either trigger\n    restart = glue_trigger || decision_trigger;\n  } else {\n    // Stable: restart only if both triggers\n    restart = glue_trigger && decision_trigger;\n  }\n\n  if (restart) {\n    // Prefer glue ratio as primary reason if both fire\n    if (glue_trigger && decision_trigger)\n      kissat_extremely_verbose(solver,\n        \"AGDHR restart: glue ratio %.2f > %.2f and decision rate drop %.2f < %.2f, primary=glue\",\n        glue_ratio, glue_ratio_threshold, decision_rate_drop, decision_rate_drop_threshold);\n    else if (glue_trigger)\n      kissat_extremely_verbose(solver,\n        \"AGDHR restart: glue ratio %.2f > %.2f\", glue_ratio, glue_ratio_threshold);\n    else\n      kissat_extremely_verbose(solver,\n        \"AGDHR restart: decision rate drop %.2f < %.2f\", decision_rate_drop, decision_rate_drop_threshold);\n\n    // Reset baseline for next window (responsibility elsewhere to update properly)\n    solver->decision_rate_baseline = decision_rate;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 612, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2059}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921ec707a0c8190a9af1ce3278caf59", "custom_id": "req-0010", "response": {"status_code": 200, "request_id": "c58afc9463613e21dc4cb5239553aab8", "body": {"id": "resp_02c4ade8b2500986006921ec3fe6088197ad9408a81e6ca4d4", "object": "response", "created_at": 1763830847, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_02c4ade8b2500986006921ec4027748197aa4e066965d42062", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n\n  if (!solver->level)\n    return false;\n\n  // Hard conflict limit check\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n  {\n    // Reset the baseline on hard restart\n    solver->decision_rate_baseline = solver->averages[solver->stable].decision_rate.value;\n    kissat_extremely_verbose (\n      solver,\n      \"conflicts %ld >= restart limit %ld (hard limit triggered, baseline reset to %g)\",\n      CONFLICTS, solver->limits.restart.conflicts, solver->decision_rate_baseline);\n    return true;\n  }\n\n  // Compute fast and slow glue\n  const double fast_glue = solver->averages[solver->stable].fast_glue.value;\n  const double slow_glue = solver->averages[solver->stable].slow_glue.value;\n\n  // Compute glue ratio\n  const double glue_ratio = fast_glue / (slow_glue > 1e-9 ? slow_glue : 1.0);\n\n  // Decision rate and baseline\n  const double decision_rate = solver->averages[solver->stable].decision_rate.value;\n  double baseline = solver->decision_rate_baseline;\n\n  // If first call, initialize baseline\n  if (baseline < 1e-9)\n    baseline = solver->decision_rate_baseline = decision_rate > 1e-9 ? decision_rate : 1.0;\n\n  // Compute decision rate drop\n  const double decision_rate_drop = decision_rate / (baseline > 1e-9 ? baseline : 1.0);\n\n  // Thresholds\n  const double GLUE_RATIO_THRESHOLD = 1.2;\n  const double DECISION_RATE_DROP_THRESHOLD = 0.7;\n\n  bool glue_trigger = glue_ratio > GLUE_RATIO_THRESHOLD;\n  bool rate_trigger = decision_rate_drop < DECISION_RATE_DROP_THRESHOLD;\n\n  bool restart = false;\n  const char *reason = 0;\n\n  if (!solver->stable)\n  {\n    // Aggressive: restart if EITHER trigger\n    if (glue_trigger || rate_trigger)\n    {\n      restart = true;\n      reason = glue_trigger && rate_trigger ? \"glue+rate\"\n                                            : (glue_trigger ? \"glue\" : \"rate\");\n    }\n  }\n  else\n  {\n    // Conservative: restart if BOTH triggers\n    if (glue_trigger && rate_trigger)\n    {\n      restart = true;\n      reason = \"glue+rate\";\n    }\n  }\n\n  if (restart)\n  {\n    // Reset the baseline to current decision rate after restart\n    solver->decision_rate_baseline = decision_rate > 1e-9 ? decision_rate : 1.0;\n\n    kissat_extremely_verbose (\n      solver,\n      \"restart triggered (%s): glue_ratio %g (fast %g / slow %g, threshold %.2f), \"\n      \"decision_rate_drop %g (rate %g / baseline %g, threshold %.2f), \"\n      \"baseline reset to %g\",\n      reason, glue_ratio, fast_glue, slow_glue, GLUE_RATIO_THRESHOLD,\n      decision_rate_drop, decision_rate, baseline, DECISION_RATE_DROP_THRESHOLD,\n      solver->decision_rate_baseline\n    );\n  }\n\n  return restart;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 715, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2162}, "user": null, "metadata": {}}}, "error": null}
