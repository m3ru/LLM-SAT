{"id": "batch_req_692138b19e508190b00c12952e1c2df4", "custom_id": "req-0001", "response": {"status_code": 200, "request_id": "cc1bd61abac12024d0692ec77e2d3244", "body": {"id": "resp_01842c129ef32d27006921388651988190aef498a7d00b6902", "object": "response", "created_at": 1763784838, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_01842c129ef32d27006921388688bc8190b633c546084882fa", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n  assert(solver->unassigned);\n  if (!GET_OPTION(restart))\n    return false;\n\n  // Must have made at least one decision\n  if (!solver->level)\n    return false;\n\n  // Conflict-limit trigger\n  if (CONFLICTS >= solver->limits.restart.conflicts) {\n    return true;\n  }\n\n  // Get glue EWMAs\n  double fast = AVERAGE(fast_glue);\n  double slow = AVERAGE(slow_glue);\n\n  // Decision rate EWMA: decisions per conflict in current interval\n  double decision_rate_ewma = solver->decision_rate_ewma;\n\n  // avg_decision_rate: EWMA of decision_rate_ewma over last k restarts (k=10)\n  double avg_decision_rate = solver->avg_decision_rate;\n\n  // Thresholds\n  double glue_margin = 0.9;\n  double dec_rate_margin = 0.8;\n\n  // If stable, double thresholds\n  if (solver->stable) {\n    glue_margin *= 2.0;\n    dec_rate_margin *= 2.0;\n  }\n\n  // Scoring trigger\n  bool scoring_trigger = false;\n  if (fast > glue_margin * slow && decision_rate_ewma < dec_rate_margin * avg_decision_rate) {\n    if (solver->level > 0)\n      scoring_trigger = true;\n    // If scoring trigger is met but at level 0, delay restart\n  }\n\n  // Tie-breaking: if both triggers, scoring prioritized\n  if (scoring_trigger)\n    return true;\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 684, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 351, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1035}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_692138b199a08190a3c9edadddc404d2", "custom_id": "req-0002", "response": {"status_code": 200, "request_id": "5e019f530125dceb27c0d0fede90b15e", "body": {"id": "resp_07938e36a33283f50069213889fd18819091bcedc49745cd34", "object": "response", "created_at": 1763784841, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_07938e36a33283f5006921388a65c48190a67294b4534b6a8f", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n\n  // Only restart at decision level > 0\n  if (!solver->level)\n    return false;\n\n  // Conflict limit trigger\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Read EWMA glue and decision-rate\n  double fast = AVERAGE (fast_glue);\n  double slow = AVERAGE (slow_glue);\n  double decision_rate = solver->decision_rate_ewma;\n  double avg_decision_rate = solver->avg_decision_rate_ewma;\n  double glue_margin = 0.9, rate_margin = 0.8;\n\n  // If stable, double the thresholds\n  if (solver->stable)\n  {\n    glue_margin *= 2.0;\n    rate_margin /= 2.0;\n  }\n\n  bool scoring_trigger = (fast > glue_margin * slow) &&\n                         (decision_rate < rate_margin * avg_decision_rate);\n\n  // Tie-breaking: if both triggers, prioritize scoring trigger\n  if (scoring_trigger)\n  {\n    // If at decision level 0, delay restart until level > 0\n    if (solver->level == 0)\n      return false;\n    return true;\n  }\n\n  // Already handled conflict-limit trigger above\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 684, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 305, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 989}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_692138b19cd08190b35de018c2fcdedb", "custom_id": "req-0003", "response": {"status_code": 200, "request_id": "35286d12b4d7c7549299e37e25247577", "body": {"id": "resp_03cfca3d4eb4c67f006921388e5d5081969ab357c74847aa53", "object": "response", "created_at": 1763784846, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_03cfca3d4eb4c67f006921388e974c81968aa863d394645528", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n  assert(solver->unassigned);\n  if (!GET_OPTION(restart))\n    return false;\n\n  // Only restart at decision level > 0\n  if (!solver->level)\n    return false;\n\n  // Conflict limit trigger\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // --- Adaptive Glue-Rate Hybrid Restart ---\n\n  // Access EWMA values and decision rate statistics\n  double fast_glue = AVERAGE(fast_glue);\n  double slow_glue = AVERAGE(slow_glue);\n  double decision_rate = AVERAGE(decision_rate);\n\n  // Maintain avg_decision_rate as EWMA over the last 10 restarts.\n  // We store this in solver->averages.avg_decision_rate (see kissat struct extension).\n  double alpha = 2.0/(10.0+1.0); // EWMA smoothing factor for k=10\n  double *avg_decision_rate_ptr = &solver->averages.avg_decision_rate;\n  if (!solver->averages.avg_decision_rate_initialized) {\n    *avg_decision_rate_ptr = decision_rate;\n    solver->averages.avg_decision_rate_initialized = true;\n  }\n\n  // After each restart, the update of avg_decision_rate is handled in the restart logic.\n  // Here, we use the current value.\n\n  double glue_factor = 0.9, rate_factor = 0.8;\n  if (solver->stable) {\n    glue_factor *= 2.0;\n    rate_factor *= 0.5; // double the threshold (rate_factor smaller -> harder to trigger)\n  }\n\n  bool scoring_trigger = (fast_glue > glue_factor * slow_glue) &&\n                         (decision_rate < rate_factor * (*avg_decision_rate_ptr));\n\n  // Tie-breaking: scoring trigger prioritized & only at level > 0\n  if (scoring_trigger && solver->level) {\n    kissat_extremely_verbose(\n      solver,\n      \"adaptive hybrid restart: fast_glue %.2f > %.2f * slow_glue %.2f AND \"\n      \"decision_rate %.2f < %.2f * avg_decision_rate %.2f (scoring trigger)\",\n      fast_glue, glue_factor, slow_glue, decision_rate,\n      rate_factor, *avg_decision_rate_ptr\n    );\n    return true;\n  }\n\n  // If conflict limit trigger but not scoring trigger, also allow restart\n  // (already handled above).\n\n  // No trigger fires\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 684, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 547, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1231}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_692138b19bf8819081802133c389f16e", "custom_id": "req-0004", "response": {"status_code": 200, "request_id": "07b06ed1cc195127f493f5696431805c", "body": {"id": "resp_0a01eb8251ef3516006921389378948195845fbd4808c0035d", "object": "response", "created_at": 1763784851, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0a01eb8251ef35160069213893acac81958f9e3d6cf40da563", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  // Conflict limit trigger\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  if (!solver->level)\n    return false;\n\n  // Adaptive thresholds for stable/unstable modes\n  double glue_fast = AVERAGE(fast_glue);\n  double glue_slow = AVERAGE(slow_glue);\n  double decision_rate = solver->decision_rate_ewma;\n  double avg_decision_rate = solver->avg_decision_rate_ewma;\n\n  double glue_threshold = 0.9;\n  double decision_threshold = 0.8;\n  if (solver->stable) {\n    glue_threshold *= 2.0;        // Double thresholds in stable mode\n    decision_threshold *= 2.0;\n  }\n\n  bool scoring_trigger = \n    (glue_fast > glue_threshold * glue_slow) &&\n    (decision_rate < decision_threshold * avg_decision_rate);\n\n  // If scoring-trigger and conflict-trigger both fire, prefer scoring\n  if (scoring_trigger) {\n    // Don't restart at level 0 due to scoring\n    if (solver->level > 0)\n      return true;\n    // else, delay restart until level > 0\n    return false;\n  }\n\n  // Conflict limit trigger (as fallback)\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 684, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 329, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1013}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_692138b1a1c08190812bc0c47dfd4061", "custom_id": "req-0005", "response": {"status_code": 200, "request_id": "c91bf8361f546166e85220ed594f1b06", "body": {"id": "resp_0b8c59c8eb823dfa006921389712108194887e664dfe2c81e7", "object": "response", "created_at": 1763784855, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0b8c59c8eb823dfa006921389765048194976961925036844d", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n\n  // Conflict limit check (as fallback/OR condition)\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Only consider restarts above decision level 0\n  if (!solver->level)\n    return false;\n\n  // Extract EWMA values\n  const double fast = AVERAGE (fast_glue);\n  const double slow = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // Adaptive avg_decision_rate over last k restarts (k=10)\n  double avg_decision_rate = solver->restart.avg_decision_rate;\n  // If not initialized, set to current rate\n  if (avg_decision_rate == 0.0)\n    avg_decision_rate = decision_rate;\n\n  // Optionally double thresholds in stable mode\n  double glue_factor = 0.9, rate_factor = 0.8;\n  if (solver->stable) {\n    glue_factor *= 2.0;        // 1.8\n    rate_factor *= 2.0;        // 1.6\n  }\n\n  // Scoring trigger\n  bool score_triggered =\n    (fast > glue_factor * slow) && (decision_rate < rate_factor * avg_decision_rate);\n\n  // If scoring trigger is met, but at level 0, delay restart\n  if (score_triggered && !solver->level)\n    return false;\n\n  // Prioritize scoring trigger over conflict limit\n  if (score_triggered)\n    return true;\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 684, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 366, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1050}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_692138b196ec8190b87e71271a09ce0a", "custom_id": "req-0006", "response": {"status_code": 200, "request_id": "8822fe5d534bacd641acc0c493e43da5", "body": {"id": "resp_0eb263cee187f4a6006921389ae08481949dd8183657eaab77", "object": "response", "created_at": 1763784858, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0eb263cee187f4a6006921389b1f5c8194b32f0c008d6715bc", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Conflict limit trigger\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // EWMA values\n  const double fast = AVERAGE (fast_glue);\n  const double slow = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // Compute avg_decision_rate as EWMA over last 10 restarts\n  const double avg_decision_rate = solver->avg_decision_rate_ewma;\n\n  // Thresholds\n  double glue_margin = 0.9;\n  double rate_margin = 0.8;\n  if (solver->stable)\n  {\n    glue_margin *= 2.0;\n    rate_margin *= 2.0;\n  }\n\n  bool scoring_trigger = false;\n  if (fast > glue_margin * slow && decision_rate < rate_margin * avg_decision_rate)\n    scoring_trigger = true;\n\n  // Tie-breaking: scoring trigger prioritized over conflict limit\n  if (scoring_trigger)\n  {\n    if (solver->level > 0)\n      return true;\n    // Else, scoring trigger met at level 0, delay restart\n    return false;\n  }\n\n  // Conflict limit trigger (if not already handled)\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 684, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 332, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1016}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_692138b1a0508190bc4cc97215dbcbb2", "custom_id": "req-0007", "response": {"status_code": 200, "request_id": "fd759272d85042859eca66ff0d82aef4", "body": {"id": "resp_07badfd3aedb594a006921389e70fc8194aa32aad9c0e0047d", "object": "response", "created_at": 1763784862, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_07badfd3aedb594a006921389ea6c08194b6243027f4803ee5", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Conflict limit check\n  if (CONFLICTS >= solver->limits.restart.conflicts) {\n    // If stable, double conflict limit threshold before triggering\n    if (solver->stable &&\n        CONFLICTS < solver->limits.restart.conflicts * 2)\n      return false;\n    return true;\n  }\n\n  // Retrieve EWMAs\n  const double fast = AVERAGE(fast_glue);\n  const double slow = AVERAGE(slow_glue);\n  const double dec_rate = AVERAGE(decision_rate);\n\n  // EWMA of avg_decision_rate over last 10 restarts\n  const double avg_dec_rate = solver->averages.avg_decision_rate_10;\n\n  // Thresholds\n  double glue_factor = 0.9, rate_factor = 0.8;\n  if (solver->stable) {\n    glue_factor *= 2.0;\n    rate_factor *= 2.0;\n  }\n\n  const double glue_threshold = glue_factor * slow;\n  const double rate_threshold = rate_factor * avg_dec_rate;\n\n  bool scoring_trigger =\n    (fast > glue_threshold) && (dec_rate < rate_threshold);\n\n  // Tie-breaking: if both triggers, prioritize scoring trigger\n  if (scoring_trigger) {\n    // If at level 0, delay restart until level > 0\n    if (!solver->level)\n      return false;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 684, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 349, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1033}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_692138b197fc8190ac8edf1f4d9774da", "custom_id": "req-0008", "response": {"status_code": 200, "request_id": "882add748f10f30a7d1261638a10a232", "body": {"id": "resp_02f87e15da9090c400692138a1fb9c8194b257306b34d9e679", "object": "response", "created_at": 1763784865, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_02f87e15da9090c400692138a23dd4819496dff81b64efe8f8", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n  assert(solver->unassigned);\n  if (!GET_OPTION(restart))\n    return false;\n\n  // Conflict limit trigger\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Decision level must be > 0 to restart\n  if (!solver->level)\n    return false;\n\n  // Retrieve EWMA averages\n  const double fast_glue = AVERAGE(fast_glue);\n  const double slow_glue = AVERAGE(slow_glue);\n  const double decision_rate = AVERAGE(decision_rate);\n\n  // avg_decision_rate: EWMA over last 10 restart intervals\n  // We use a field in solver to store avg_decision_rate, updated on each restart\n  double avg_decision_rate = solver->avg_decision_rate;\n  if (avg_decision_rate == 0)\n    avg_decision_rate = decision_rate; // Initialize if never set\n\n  // If stable, double the thresholds\n  double glue_margin = solver->stable ? 1.8 : 0.9;\n  double rate_margin = solver->stable ? 1.6 : 0.8;\n\n  bool glue_condition = (fast_glue > glue_margin * slow_glue);\n  bool rate_condition = (decision_rate < rate_margin * avg_decision_rate);\n\n  bool scoring_trigger = glue_condition && rate_condition;\n\n  kissat_extremely_verbose(solver,\n    \"restarting check: fast_glue %.3f, slow_glue %.3f, decision_rate %.3f, avg_decision_rate %.3f, \"\n    \"glue_margin %.2f, rate_margin %.2f, scoring_trigger %d, conflicts %\" PRIu64 \" limit %\" PRIu64,\n    fast_glue, slow_glue, decision_rate, avg_decision_rate,\n    glue_margin, rate_margin, scoring_trigger, CONFLICTS, solver->limits.restart.conflicts);\n\n  // If scoring trigger met but at level 0, delay restart\n  if (scoring_trigger && solver->level == 0)\n    return false;\n\n  // Prioritize scoring trigger if both fire\n  if (scoring_trigger)\n    return true;\n\n  // Conflict limit trigger (if not already fired above)\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 684, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 506, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1190}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_692138b19e0c8190a1ea004d447d2945", "custom_id": "req-0009", "response": {"status_code": 200, "request_id": "3646ff316f7d4467044c3a2afc45f60b", "body": {"id": "resp_08d9980f8366ff3300692138a673048193b9f20d3ca781f070", "object": "response", "created_at": 1763784870, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_08d9980f8366ff3300692138a6b15081938d80cac04d651356", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n  assert(solver->unassigned);\n  if (!GET_OPTION(restart))\n    return false;\n  // Do not restart at root level.\n  if (!solver->level)\n    return false;\n\n  // Conflict limit based trigger.\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Hybrid glue-rate scoring trigger.\n  // Get EWMA averages (fast/slow glue, decision rate)\n  const double fast_glue = AVERAGE(fast_glue);\n  const double slow_glue = AVERAGE(slow_glue);\n  const double decision_rate = AVERAGE(decision_rate);\n\n  // Maintain avg_decision_rate as EWMA over last 10 restarts.\n  // We use a field in solver->averages for this (assume it exists as avg_decision_rate, with window=10).\n  double avg_decision_rate;\n#if defined(KISSAT_AVERAGE_DECISION_RATE)\n  avg_decision_rate = AVERAGE(avg_decision_rate);\n#else\n  // Fallback: use slow average as proxy.\n  avg_decision_rate = AVERAGE(decision_rate);\n#endif\n\n  // Thresholds\n  double glue_margin = 0.9, rate_margin = 0.8;\n  if (solver->stable) {\n    glue_margin *= 2.0;   // becomes 1.8\n    rate_margin *= 2.0;   // becomes 1.6\n  }\n\n  // Compute conditions\n  bool scoring_trigger = false;\n  if (fast_glue > glue_margin * slow_glue &&\n      decision_rate < rate_margin * avg_decision_rate)\n    scoring_trigger = true;\n\n  // Tie-breaking: scoring trigger has priority.\n  if (scoring_trigger) {\n    // If at root level, delay restart.\n    if (solver->level == 0)\n      return false;\n    kissat_extremely_verbose(\n        solver,\n        \"adaptive glue-rate hybrid scoring restart: \"\n        \"fast_glue=%.2f > %.2f*slow_glue=%.2f, \"\n        \"decision_rate=%.4f < %.2f*avg_decision_rate=%.4f\",\n        fast_glue, glue_margin, slow_glue, decision_rate, rate_margin, avg_decision_rate);\n    return true;\n  }\n\n  // Conflict-limit trigger if not already triggered above.\n  if (CONFLICTS >= solver->limits.restart.conflicts) {\n    kissat_extremely_verbose(\n        solver,\n        \"adaptive glue-rate hybrid conflict-limit restart: \"\n        \"conflicts=%\" PRIu64 \" >= restart_conflict_limit=%\" PRIu64,\n        CONFLICTS, solver->limits.restart.conflicts);\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 684, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 594, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1278}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_692138b19fe48190bc063e1d1022a8ea", "custom_id": "req-0010", "response": {"status_code": 200, "request_id": "edf38761ae5c721234388e283f1a29e9", "body": {"id": "resp_0c5857f5a457af5000692138aba6948196bca147c01c4331c6", "object": "response", "created_at": 1763784875, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0c5857f5a457af5000692138abdf48819690bda26dd2b971ad", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n  assert(solver->unassigned);\n  if (!GET_OPTION(restart))\n    return false;\n\n  // Only consider restart at decision level > 0\n  if (!solver->level)\n    return false;\n\n  // Conflict limit trigger (always available)\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Gather EWMAs\n  const double fast = AVERAGE(fast_glue);\n  const double slow = AVERAGE(slow_glue);\n  const double dr = AVERAGE(decision_rate);\n\n  // Adaptive EWMA over last k=10 restart intervals\n  double avg_decision_rate;\n  {\n    // Use internal ring buffer of last 10 decision_rate_ewma values\n    // These are maintained and updated at each restart (see restart handler)\n    const unsigned k = 10;\n    double sum = 0.0;\n    unsigned count = 0;\n    for (unsigned i = 0; i < k; i++) {\n      double prev = solver->restart.avg_decision_rate_ring[i];\n      if (prev > 0.0) {\n        sum += prev;\n        count++;\n      }\n    }\n    if (count)\n      avg_decision_rate = sum / count;\n    else\n      avg_decision_rate = dr; // fallback: current EWMA if no history\n  }\n\n  // Thresholds\n  double glue_factor = 0.9, dr_factor = 0.8;\n  if (solver->stable) {\n    glue_factor *= 2.0;\n    dr_factor *= 2.0;\n  }\n\n  const double glue_limit = glue_factor * slow;\n  const double dr_limit = dr_factor * avg_decision_rate;\n\n  bool scoring_trigger = (fast > glue_limit) && (dr < dr_limit);\n\n  // Tie-breaking: scoring trigger wins if both fire, and only restart at level > 0\n  if (scoring_trigger) {\n    if (solver->level > 0) {\n      kissat_extremely_verbose(\n        solver,\n        \"adaptive glue-rate hybrid restart: \"\n        \"fast_glue %g > glue_limit %g, decision_rate %g < dr_limit %g\",\n        fast, glue_limit, dr, dr_limit\n      );\n      return true;\n    } else {\n      // scoring trigger met, but at level 0: delay\n      return false;\n    }\n  }\n\n  // If only conflict limit fires, and not scoring trigger, allow restart\n  if (CONFLICTS >= solver->limits.restart.conflicts) {\n    kissat_extremely_verbose(\n      solver,\n      \"adaptive glue-rate hybrid restart: conflict limit %u >= %u\",\n      CONFLICTS, solver->limits.restart.conflicts\n    );\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 684, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 603, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1287}, "user": null, "metadata": {}}}, "error": null}
