{"id": "batch_req_6921e604fb8481908bbfc307ce66985e", "custom_id": "req-0001", "response": {"status_code": 200, "request_id": "4dc6e1626036b972e0c5f66ffd99a5f3", "body": {"id": "resp_008911559f6656f5006921e5d975508197a5be22daf4701881", "object": "response", "created_at": 1763829209, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_008911559f6656f5006921e5d9d0f48197bf978c6d6a12e4fb", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Always force restart if conflicts exceed limit\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Static storage for last restart conflict number and long-term decision rate\n  static uint64_t last_restart_conflict = 0;\n  static double long_term_decision_rate = 0.0;\n  static uint64_t long_term_window = 1000;\n\n  // Get current EWMA values\n  const double fast = AVERAGE (fast_glue);\n  const double slow = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // Update long-term decision rate: O(1) running average\n  if (solver->statistics.conflicts > 0)\n  {\n    // Use Welford's O(1) running average update\n    if (long_term_decision_rate == 0.0)\n      long_term_decision_rate = decision_rate;\n    else\n      long_term_decision_rate += (decision_rate - long_term_decision_rate) / (double)long_term_window;\n  }\n\n  // Compute thresholds\n  const double glue_thresh = 0.95 * slow;\n  const double rate_thresh = 0.85 * long_term_decision_rate;\n\n  bool glue_cond = (fast > glue_thresh);\n  bool rate_cond = (decision_rate < rate_thresh);\n\n  // Tie-breaking: thresholds within 3% (i.e., almost equal)\n  const double glue_margin = 0.03 * slow;\n  const double rate_margin = 0.03 * long_term_decision_rate;\n  bool glue_near = fabs (fast - glue_thresh) <= glue_margin;\n  bool rate_near = fabs (decision_rate - rate_thresh) <= rate_margin;\n\n  // Minimum interval between restarts\n  uint64_t min_interval = solver->stable ? 200 : 50;\n  uint64_t since_last = solver->statistics.conflicts - last_restart_conflict;\n\n  bool trigger = false;\n  if (glue_cond && rate_cond)\n    trigger = true;\n  else if (glue_near && rate_near)\n    trigger = true;\n\n  // Only restart if minimum interval has passed\n  if (trigger && since_last >= min_interval)\n  {\n    last_restart_conflict = solver->statistics.conflicts;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 546, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1326}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e604e88881909defe7e9ff59cbe3", "custom_id": "req-0002", "response": {"status_code": 200, "request_id": "162291ee658ff5a0b896aed47130de3d", "body": {"id": "resp_01ecbd183afed24b006921e5dc3998819789eab8538c64b0ef", "object": "response", "created_at": 1763829212, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_01ecbd183afed24b006921e5dc6a50819786c4b5c9b2956b7e", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver)\n{\n  assert(solver->unassigned);\n\n  if (!GET_OPTION(restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Force restart if conflict limit reached\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // --- Dynamic Glue-Rate Adaptive Restart (DGAR) implementation ---\n  // Averages\n  const int mode = solver->stable;\n  const double fast_glue = solver->averages[mode].fast_glue.value;\n  const double slow_glue = solver->averages[mode].slow_glue.value;\n  const double decision_rate = solver->averages[mode].decision_rate.value;\n\n  // --- Maintain long-term decision rate (EWMA over 1000 conflicts) ---\n  // We'll use solver->restart.long_term_decision_rate for this, initialized to decision_rate initially\n  if (solver->statistics.conflicts == 0)\n    solver->restart.long_term_decision_rate = decision_rate;\n  else\n  {\n    // EWMA weight: alpha = 1/1000\n    const double alpha = 1.0 / 1000.0;\n    solver->restart.long_term_decision_rate =\n        (1.0 - alpha) * solver->restart.long_term_decision_rate + alpha * decision_rate;\n  }\n  const double long_term_decision_rate = solver->restart.long_term_decision_rate;\n\n  // --- Enforce minimum interval between restarts ---\n  const unsigned min_interval = mode ? 200 : 50;\n  if (solver->statistics.conflicts < solver->restart.last_restart_conflict + min_interval)\n    return false;\n\n  // --- Compute thresholds ---\n  const double glue_threshold = 0.95 * slow_glue;\n  const double decision_threshold = 0.85 * long_term_decision_rate;\n\n  // --- Check if thresholds are met ---\n  bool glue_met = (fast_glue > glue_threshold);\n  bool decision_met = (decision_rate < decision_threshold);\n\n  // --- Tie-breaking: within 3% -- prefer to restart ---\n  if (!glue_met && fast_glue > 0.92 * slow_glue)\n    glue_met = true;\n  if (!decision_met && decision_rate < 0.88 * long_term_decision_rate)\n    decision_met = true;\n\n  // --- Final restart decision ---\n  if (glue_met && decision_met)\n  {\n    solver->restart.last_restart_conflict = solver->statistics.conflicts;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 545, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1325}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e60500608190b8970ec7a4f9d794", "custom_id": "req-0003", "response": {"status_code": 200, "request_id": "5ff477e1383827123834f0256df9bd8d", "body": {"id": "resp_0d2cfddff7a10639006921e5dd86d88194b7b1df1449d685a8", "object": "response", "created_at": 1763829213, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0d2cfddff7a10639006921e5ddcb20819497ac06ab83a6331c", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Always restart if hard conflict limit reached (force restart)\n  if (CONFLICTS < solver->limits.restart.conflicts)\n    return false;\n\n  // --- Parameters for DGAR ---\n  // Minimum interval between restarts (default 50, 200 if stable)\n  static const unsigned default_min_interval = 50;\n  static const unsigned stable_min_interval = 200;\n\n  unsigned min_interval = solver->stable ? stable_min_interval : default_min_interval;\n  kissat_extremely_verbose(solver, \"DGAR: min_interval = %u\", min_interval);\n\n  // Use static persistent storage for last restart conflict index and long_term_decision_rate\n  static uint64_t last_restart_conflict = 0;\n  static double long_term_decision_rate = 0.0;\n  static uint64_t last_update_conflict = 0;\n\n  // Only update long-term average once per conflict\n  if (last_update_conflict != CONFLICTS) {\n    // O(1) running average for long_term_decision_rate over 1000 conflicts\n    const double alpha = 1.0 / 1000.0;\n    double dr = solver->averages[solver->stable].decision_rate.value;\n    if (long_term_decision_rate == 0.0)\n      long_term_decision_rate = dr;\n    else\n      long_term_decision_rate = (1.0 - alpha) * long_term_decision_rate + alpha * dr;\n    last_update_conflict = CONFLICTS;\n  }\n\n  // Enforce minimum interval between restarts\n  uint64_t since_last_restart = CONFLICTS - last_restart_conflict;\n  if (since_last_restart < min_interval)\n    return false;\n\n  // Read EWMA glue and decision rate\n  const double fast_glue = solver->averages[solver->stable].fast_glue.value;\n  const double slow_glue = solver->averages[solver->stable].slow_glue.value;\n  const double decision_rate = solver->averages[solver->stable].decision_rate.value;\n\n  // Compute thresholds\n  const double glue_thresh = 0.95 * slow_glue;\n  const double decision_rate_thresh = 0.85 * long_term_decision_rate;\n\n  // Tie-breaking region: if within 3% of threshold, prefer to restart\n  bool glue_close = (fast_glue >= 0.92 * slow_glue) && (fast_glue <= glue_thresh * 1.03);\n  bool dr_close = (decision_rate <= decision_rate_thresh * 1.03) && (decision_rate >= decision_rate_thresh * 0.97);\n\n  // Core restart condition\n  bool glue_cond = (fast_glue > glue_thresh);\n  bool dr_cond = (decision_rate < decision_rate_thresh);\n\n  bool trigger_restart = false;\n  if (glue_cond && dr_cond)\n    trigger_restart = true;\n  else if (glue_close && dr_close)\n    trigger_restart = true;\n\n  // Always restart if conflict hard limit reached (force)\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    trigger_restart = true;\n\n  kissat_extremely_verbose(\n    solver,\n    \"DGAR: fast_glue=%.3f slow_glue=%.3f (threshold=%.3f) decision_rate=%.6f long_term_decision_rate=%.6f (threshold=%.6f) trigger=%d\",\n    fast_glue, slow_glue, glue_thresh,\n    decision_rate, long_term_decision_rate, decision_rate_thresh,\n    (int)trigger_restart);\n\n  if (trigger_restart) {\n    last_restart_conflict = CONFLICTS;\n    return true;\n  } else {\n    return false;\n  }\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 829, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1609}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e604fa288190847911721c1000d9", "custom_id": "req-0004", "response": {"status_code": 200, "request_id": "6240de64c94981a837d2391bbc95eb5f", "body": {"id": "resp_0d263acc856d378f006921e5e08e308194b254bca141a3b4af", "object": "response", "created_at": 1763829216, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0d263acc856d378f006921e5e0dee4819488729c6d5e4ca34f", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n    assert(solver->unassigned);\n\n    if (!GET_OPTION(restart))\n        return false;\n\n    if (!solver->level)\n        return false;\n\n    // Conflict limit: always force restart if limit reached\n    if (CONFLICTS >= solver->limits.restart.conflicts)\n        return true;\n\n    // Minimum interval between restarts\n    static uint64_t last_restart_conflict = 0;\n    static uint64_t longterm_count = 0;\n    static double longterm_decision_rate = 0.0;\n\n    // Get current conflict count\n    uint64_t conflicts = CONFLICTS;\n\n    // Adaptive interval for stable phase\n    uint64_t min_interval = solver->stable ? 200 : 50;\n    if (conflicts < last_restart_conflict + min_interval)\n        return false;\n\n    // Get glue averages and decision rate\n    const double fast_glue = AVERAGE(fast_glue);\n    const double slow_glue = AVERAGE(slow_glue);\n    const double decision_rate = AVERAGE(decision_rate);\n\n    // Update long-term (O(1) moving) average of decision rate over 1000 conflicts\n    if (longterm_count == 0)\n        longterm_decision_rate = decision_rate;\n    else\n        longterm_decision_rate += (decision_rate - longterm_decision_rate) / (double) (longterm_count < 1000 ? longterm_count + 1 : 1000);\n    if (longterm_count < 1000)\n        ++longterm_count;\n\n    // Glue threshold\n    const double glue_thresh = 0.95 * slow_glue;\n    // Decision rate threshold\n    const double dec_rate_thresh = 0.85 * longterm_decision_rate;\n\n    bool glue_met = fast_glue > glue_thresh;\n    bool dec_rate_met = decision_rate < dec_rate_thresh;\n\n    // Tie-breaking: if both are within 3% of threshold, prefer restart\n    bool tie = false;\n    if (!glue_met && !dec_rate_met) {\n        double glue_rel = (fast_glue - glue_thresh) / (slow_glue ? slow_glue : 1.0);\n        double dec_rel = (decision_rate - dec_rate_thresh) / (longterm_decision_rate ? longterm_decision_rate : 1.0);\n        if (glue_rel > -0.03 && glue_rel < 0.03 && dec_rel > -0.03 && dec_rel < 0.03)\n            tie = true;\n    }\n\n    // Restart if both scoring conditions or tie-breaking, otherwise no restart\n    if ((glue_met && dec_rate_met) || tie) {\n        last_restart_conflict = conflicts;\n        kissat_extremely_verbose(\n            solver,\n            \"DGAR restart: fast_glue %g (thresh %g), slow_glue %g, decision_rate %g (thresh %g), longterm_dec_rate %g, stable %d, conflict %\" PRIu64,\n            fast_glue, glue_thresh, slow_glue, decision_rate, dec_rate_thresh, longterm_decision_rate, solver->stable, conflicts\n        );\n        return true;\n    }\n\n    return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 692, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1472}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e604ff208190af6002bb65a85dca", "custom_id": "req-0005", "response": {"status_code": 200, "request_id": "b43f1fa2645dc354e6e04d70e736bc4f", "body": {"id": "resp_0267cc47efb9001d006921e5e38f10819097bc0faf97aa607c", "object": "response", "created_at": 1763829219, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0267cc47efb9001d006921e5e46b988190804f55989eaf1c9a", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver) {\n    assert(solver->unassigned);\n\n    // Option enabled?\n    if (!GET_OPTION(restart))\n        return false;\n\n    // At top-level?\n    if (!solver->level)\n        return false;\n\n    // Conflict limit reached? Always restart.\n    if (CONFLICTS >= solver->limits.restart.conflicts)\n        return true;\n\n    // --- DGAR stateful storage ---\n    // These must be static or attached to the solver for persistent tracking.\n    static double long_term_decision_rate = 0.0;\n    static uint64_t last_conflict_for_restart = 0;\n    static uint64_t last_conflict_updated = 0;\n    static int initialized = 0;\n\n    // Parameters\n    const double glue_threshold = 0.95;\n    const double glue_close = 0.03; // 3%\n    const double decision_rate_threshold = 0.85;\n    const uint64_t long_term_window = 1000;\n    const uint64_t min_interval = solver->stable ? 200 : 50;\n\n    // EWMA sources\n    const double fast_glue = AVERAGE(fast_glue);\n    const double slow_glue = AVERAGE(slow_glue);\n    const double decision_rate = AVERAGE(decision_rate);\n\n    // Initialize on first call\n    if (!initialized || solver->statistics.conflicts < last_conflict_updated) {\n        long_term_decision_rate = decision_rate;\n        last_conflict_for_restart = solver->statistics.conflicts ? solver->statistics.conflicts - min_interval : 0;\n        last_conflict_updated = solver->statistics.conflicts;\n        initialized = 1;\n    }\n\n    // Update long_term_decision_rate every conflict, only once per conflict\n    if (solver->statistics.conflicts != last_conflict_updated) {\n        // O(1) running average\n        long_term_decision_rate += (decision_rate - long_term_decision_rate) / (double)long_term_window;\n        last_conflict_updated = solver->statistics.conflicts;\n    }\n\n    // Enforce minimum interval between restarts\n    if (solver->statistics.conflicts < last_conflict_for_restart + min_interval)\n        return false;\n\n    // --- DGAR scoring condition ---\n    bool glue_condition = (fast_glue > glue_threshold * slow_glue);\n    bool glue_tiebreak = (fast_glue > (glue_threshold - glue_close) * slow_glue);\n    bool decision_condition = (decision_rate < decision_rate_threshold * long_term_decision_rate);\n    bool decision_tiebreak = (decision_rate < (decision_rate_threshold + glue_close) * long_term_decision_rate);\n\n    bool eligible = false;\n    if (glue_condition && decision_condition) {\n        eligible = true;\n    } else if (glue_tiebreak && decision_tiebreak) {\n        eligible = true;\n    }\n\n    if (eligible) {\n        // Only restart if most recent fast_glue is the highest this interval (tiebreak for multiple restarts)\n        // For simplicity, since only one restart per interval is allowed, this is always true.\n        last_conflict_for_restart = solver->statistics.conflicts;\n        kissat_extremely_verbose(solver,\n            \"DGAR restart: fast_glue=%.2f slow_glue=%.2f (%.1f%%) decision_rate=%.2f long_term=%.2f (%.1f%%) interval=%\" PRIu64,\n            fast_glue, slow_glue, 100.0 * fast_glue / slow_glue,\n            decision_rate, long_term_decision_rate, 100.0 * decision_rate / long_term_decision_rate,\n            min_interval\n        );\n        return true;\n    }\n\n    return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 798, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1578}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e604fd88819090f622fe5669c641", "custom_id": "req-0006", "response": {"status_code": 200, "request_id": "35b84da049acda3356f097ab8c377b51", "body": {"id": "resp_0bf3fba73cf183c7006921e5e5e1d08193a541dac24cddf751", "object": "response", "created_at": 1763829221, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0bf3fba73cf183c7006921e5e621608193b5207f2c30e8efed", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Always force restart if conflict limit is reached\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Parameters\n  const unsigned min_interval = solver->stable ? 200 : 50;\n\n  // Enforce minimum interval between restarts\n  static uint64_t last_restart_conflict = 0;\n  if (CONFLICTS < last_restart_conflict + min_interval)\n    return false;\n\n  // Compute glue EWMAs\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n\n  // Compute decision rate EWMA\n  const double decision_rate = solver->averages[solver->stable].decision_rate.value;\n\n  // Maintain/update long term decision rate (O(1) running average over 1000 conflicts)\n  static double long_term_decision_rate = 0.0;\n  static uint64_t last_conflict = 0;\n  if (last_conflict != CONFLICTS) {\n    if (long_term_decision_rate == 0.0)\n      long_term_decision_rate = decision_rate;\n    else\n      long_term_decision_rate += (decision_rate - long_term_decision_rate) / 1000.0;\n    last_conflict = CONFLICTS;\n  }\n\n  // Compute thresholds\n  const double glue_threshold = 0.95 * slow_glue;\n  const double decision_rate_threshold = 0.85 * long_term_decision_rate;\n\n  const bool glue_cond = (fast_glue > glue_threshold);\n  const bool decision_rate_cond = (decision_rate < decision_rate_threshold);\n\n  // Tie-breaking: if both are within 3%, prefer to restart\n  const double glue_margin = 0.03 * slow_glue;\n  const double decision_rate_margin = 0.03 * long_term_decision_rate;\n  const bool glue_near = (fast_glue > glue_threshold - glue_margin);\n  const bool decision_rate_near = (decision_rate < decision_rate_threshold + decision_rate_margin);\n\n  bool restart = false;\n  if (glue_cond && decision_rate_cond)\n    restart = true;\n  else if (glue_near && decision_rate_near)\n    restart = true;\n\n  if (restart) {\n    last_restart_conflict = CONFLICTS;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 549, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1329}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e604ffc88190b7f0f11ed1909055", "custom_id": "req-0007", "response": {"status_code": 200, "request_id": "9c67ca03361a50068f0f23cb52047374", "body": {"id": "resp_0c7f43fb96395634006921e5f15c548195ba759150eae852e7", "object": "response", "created_at": 1763829233, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0c7f43fb96395634006921e5f18c7c8195bf87f482c4a8aca5", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Always restart if hard conflict limit reached\n  if (CONFLICTS < solver->limits.restart.conflicts)\n    return false;\n\n  // --- DGAR-specific state ---\n  // We need to maintain a long-term average of decision rate (over 1000 conflicts)\n  // We keep this in solver->dgar_long_term_decision_rate\n  // and track last restart conflict in solver->dgar_last_restart_conflict.\n  // These must be zero-initialized somewhere in solver initialization.\n\n  // Update long-term decision rate average (O(1) running average)\n  double cur_decision_rate = solver->averages[solver->stable].decision_rate.value;\n  uint64_t conflicts = solver->statistics.conflicts;\n  // This is a running average: avg <- avg + (x - avg)/N\n  // Only update after each conflict (not multiple times per conflict)\n  if (conflicts != solver->dgar_last_conflict_update) {\n    solver->dgar_last_conflict_update = conflicts;\n    // For first 1000 conflicts, average is just the mean so far\n    if (solver->dgar_long_term_count < 1000) {\n      solver->dgar_long_term_count++;\n      solver->dgar_long_term_decision_rate += (cur_decision_rate - solver->dgar_long_term_decision_rate) / solver->dgar_long_term_count;\n    } else {\n      solver->dgar_long_term_decision_rate += (cur_decision_rate - solver->dgar_long_term_decision_rate) / 1000.0;\n    }\n  }\n\n  // Compute minimum interval between restarts\n  uint64_t min_interval = solver->stable ? 200 : 50;\n  uint64_t since_last_restart = conflicts - solver->dgar_last_restart_conflict;\n  if (since_last_restart < min_interval)\n    return false;\n\n  // Fetch glue and decision rate averages\n  const double fast_glue = solver->averages[solver->stable].fast_glue.value;\n  const double slow_glue = solver->averages[solver->stable].slow_glue.value;\n  const double fast_threshold = 0.95 * slow_glue;\n\n  const double decision_rate = cur_decision_rate;\n  const double long_term_decision_rate = solver->dgar_long_term_decision_rate;\n  const double decision_rate_threshold = 0.85 * long_term_decision_rate;\n\n  bool glue_cond = (fast_glue > fast_threshold);\n  bool decision_cond = (decision_rate < decision_rate_threshold);\n\n  // Tie-breaking: if within 3% of either threshold, prefer to restart\n  bool tie_glue = (!glue_cond && fast_glue >= 0.92 * slow_glue);\n  bool tie_decision = (!decision_cond && decision_rate <= 0.88 * long_term_decision_rate);\n\n  bool trigger_restart = (glue_cond && decision_cond) || (tie_glue && tie_decision);\n\n  if (trigger_restart) {\n    // If multiple restarts eligible, favor higher fast_glue (already implied)\n    solver->dgar_last_restart_conflict = conflicts;\n    kissat_extremely_verbose (solver,\n      \"DGAR restart: fast_glue %.3f slow_glue %.3f (thresh %.3f), \"\n      \"decision_rate %.3f (long-term %.3f, thresh %.3f), \"\n      \"conflicts since last restart %llu (min %llu)%s\",\n      fast_glue, slow_glue, fast_threshold,\n      decision_rate, long_term_decision_rate, decision_rate_threshold,\n      (unsigned long long)since_last_restart, (unsigned long long)min_interval,\n      (tie_glue && tie_decision ? \" [tie-break]\" : \"\"));\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 849, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1629}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e604fac0819094947369b155db23", "custom_id": "req-0008", "response": {"status_code": 200, "request_id": "d13fe4770912513af180de931a563a34", "body": {"id": "resp_0007dfda217fd3dd006921e5ed87988195ae3696750b0e0fa2", "object": "response", "created_at": 1763829229, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0007dfda217fd3dd006921e5edc8ec8195bb229ba8729774d0", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Force restart if reaching hard conflict limit\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // --- DGAR state (static, survives calls) ---\n  static double long_term_decision_rate = 0.0;\n  static uint64_t last_update_conflicts = 0;\n  static uint64_t last_restart_conflicts = 0;\n  static bool initialized = false;\n  // If solver is reset, re-init state\n  if (CONFLICTS == 0 || !initialized) {\n    long_term_decision_rate = AVERAGE(decision_rate);\n    last_update_conflicts = 0;\n    last_restart_conflicts = 0;\n    initialized = true;\n  }\n\n  // --- Update long-term average once per conflict ---\n  if (last_update_conflicts != CONFLICTS) {\n    // O(1) running average over 1000 conflicts\n    const double alpha = 1.0 / 1000.0;\n    double dr = AVERAGE(decision_rate);\n    long_term_decision_rate = (1.0 - alpha) * long_term_decision_rate + alpha * dr;\n    last_update_conflicts = CONFLICTS;\n  }\n\n  // --- Minimum interval between restarts ---\n  unsigned min_restart_interval = solver->stable ? 200 : 50;\n  if (CONFLICTS < last_restart_conflicts + min_restart_interval)\n    return false;\n\n  // --- Scoring conditions ---\n  const double fast = AVERAGE(fast_glue);\n  const double slow = AVERAGE(slow_glue);\n  const double dr = AVERAGE(decision_rate);\n\n  bool glue_cond = fast > 0.95 * slow;\n  bool dr_cond   = dr < 0.85 * long_term_decision_rate;\n\n  // Tie-breaking: thresholds within 3%\n  bool close_glue = (fast > 0.92 * slow && fast <= 0.95 * slow);\n  bool close_dr   = (dr >= 0.85 * long_term_decision_rate && dr < 0.88 * long_term_decision_rate);\n\n  bool eligible = false;\n  if (glue_cond && dr_cond)\n    eligible = true;\n  else if ((close_glue && dr_cond) || (glue_cond && close_dr))  // within 3%\n    eligible = true;\n\n  if (eligible) {\n    last_restart_conflicts = CONFLICTS;\n    // Favor the restart with higher fast_glue if multiple eligible (implicit: we only get here once per conflict)\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 598, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1378}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e604ec9481909f43aa91f7e304cf", "custom_id": "req-0009", "response": {"status_code": 200, "request_id": "73a7757b2d5369c42b382b75bad08d6d", "body": {"id": "resp_022621deb82ebc9b006921e5faf48081908afaecd0d836f7bc", "object": "response", "created_at": 1763829242, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_022621deb82ebc9b006921e5fb7c5c8190b04a52c3eae0d03d", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Forced restart if conflict limit reached\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  const int stable = solver->stable;\n\n  // Minimum interval between restarts\n  static unsigned last_restart_conflict = 0;\n  static unsigned last_restart_stamp = 0;\n  unsigned min_interval = stable ? 200 : 50;\n\n  // Use a unique key for this solver instance (by address)\n  // to avoid conflicts in parallel runs if needed\n  if (last_restart_stamp != (unsigned)(uintptr_t)solver) {\n    last_restart_conflict = 0;\n    last_restart_stamp = (unsigned)(uintptr_t)solver;\n  }\n\n  unsigned since_last = (unsigned)(CONFLICTS - last_restart_conflict);\n  if (since_last < min_interval)\n    return false;\n\n  // Extract solver statistics\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = solver->averages[solver->stable].decision_rate.value;\n\n  // Persistent long-term decision rate\n  static double long_term_decision_rate = 0;\n  static unsigned long_term_dr_stamp = 0;\n  static unsigned long_term_dr_n = 0;\n  // Reset long_term_decision_rate if new solver instance\n  if (long_term_dr_stamp != (unsigned)(uintptr_t)solver) {\n    long_term_decision_rate = decision_rate;\n    long_term_dr_n = 1;\n    long_term_dr_stamp = (unsigned)(uintptr_t)solver;\n  } else if (since_last > 0) {\n    // O(1) moving average over 1000 conflicts\n    long_term_dr_n++;\n    const double alpha = 1.0 / (long_term_dr_n < 1000 ? long_term_dr_n : 1000.0);\n    long_term_decision_rate = (1.0 - alpha) * long_term_decision_rate + alpha * decision_rate;\n  }\n\n  // Compute thresholds\n  const double glue_threshold = 0.95 * slow_glue;\n  const double dr_threshold = 0.85 * long_term_decision_rate;\n\n  bool glue_cond = fast_glue > glue_threshold;\n  bool dr_cond = decision_rate < dr_threshold;\n\n  // Tie-breaking: within 3% margin, prefer to restart\n  bool glue_close = !glue_cond && fast_glue > 0.92 * slow_glue;\n  bool dr_close = !dr_cond && decision_rate < 0.88 * long_term_decision_rate;\n\n  if ((glue_cond && dr_cond) ||\n      ((glue_cond || glue_close) && (dr_cond || dr_close))) {\n    last_restart_conflict = (unsigned)CONFLICTS;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 648, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1428}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e604f9a0819083742a8e34d699ab", "custom_id": "req-0010", "response": {"status_code": 200, "request_id": "c7f7a6d3743dc0a45bdbdc1e7b3cc331", "body": {"id": "resp_008fef6dc639537c006921e5f39d0081978f212d0a2f39caad", "object": "response", "created_at": 1763829235, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_008fef6dc639537c006921e5f3daf88197895614d9ee5e834e", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Forced restart if solver reached conflict limit\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Use static variables to store long-term decision rate and restart interval state\n  static double long_term_decision_rate = 0.0;\n  static uint64_t last_update_conflicts = 0;\n  static uint64_t last_restart_conflicts = 0;\n  static bool initialized = false;\n\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // Maintain a running average for long_term_decision_rate (1000 conflict window)\n  if (!initialized) {\n    // Initialize on first call\n    long_term_decision_rate = decision_rate;\n    last_update_conflicts = CONFLICTS;\n    last_restart_conflicts = (CONFLICTS > 0) ? CONFLICTS : 0;\n    initialized = true;\n  } else if (CONFLICTS != last_update_conflicts) {\n    // Exponential moving average for long-term rate, alpha = 1/1000\n    const double alpha = 1.0 / 1000.0;\n    long_term_decision_rate =\n      (1.0 - alpha) * long_term_decision_rate + alpha * decision_rate;\n    last_update_conflicts = CONFLICTS;\n  }\n\n  // Enforce minimum interval between restarts\n  uint64_t min_restart_interval = solver->stable ? 200 : 50;\n  uint64_t since_last_restart = CONFLICTS - last_restart_conflicts;\n  if (since_last_restart < min_restart_interval)\n    return false;\n\n  // Compute thresholds\n  const double glue_threshold = 0.95 * slow_glue;\n  const double rate_threshold = 0.85 * long_term_decision_rate;\n\n  bool glue_ok = fast_glue > glue_threshold;\n  bool rate_ok = decision_rate < rate_threshold;\n\n  // Tie-breaker: if both conditions are within 3% of threshold, prefer restart\n  bool glue_close = !glue_ok && (fast_glue > 0.92 * slow_glue);\n  bool rate_close = !rate_ok && (decision_rate < 0.88 * long_term_decision_rate);\n\n  bool should_restart = false;\n\n  if (glue_ok && rate_ok)\n    should_restart = true;\n  else if (glue_close && rate_close)\n    should_restart = true;\n\n  if (should_restart) {\n    // Favor higher fast_glue if multiple restarts are eligible in same conflict (handled by condition)\n    last_restart_conflicts = CONFLICTS;\n    kissat_extremely_verbose (\n      solver,\n      \"DGAR restart: fast_glue=%.2f slow_glue=%.2f decision_rate=%.4f long_term_decision_rate=%.4f (interval=%\" PRIu64 \")\",\n      fast_glue, slow_glue, decision_rate, long_term_decision_rate, since_last_restart);\n    return true;\n  }\n\n  return false;\n}\n</code>\n"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 780, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 704, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 1484}, "user": null, "metadata": {}}}, "error": null}
