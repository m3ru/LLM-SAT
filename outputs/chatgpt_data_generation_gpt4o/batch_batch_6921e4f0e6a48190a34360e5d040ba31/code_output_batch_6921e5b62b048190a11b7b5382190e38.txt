{"id": "batch_req_6921e6394bc88190a8b8c36f9275fe5c", "custom_id": "req-0001", "response": {"status_code": 200, "request_id": "5605be2ff77cb2ef038473c24260ceba", "body": {"id": "resp_02bf0ee20118bee1006921e63273008195a863048084499842", "object": "response", "created_at": 1763829298, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_02bf0ee20118bee1006921e632b98481958f06b827013577ca", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Hard limit: force restart if conflicts exceed the limit.\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n  {\n    kissat_extremely_verbose (solver,\n      \"conflicts hard limit %ld reached (limit %ld), forcing restart\",\n      CONFLICTS, solver->limits.restart.conflicts);\n    // Reset decision_rate_baseline after restart\n    solver->decision_rate_baseline = AVERAGE (decision_rate);\n    return true;\n  }\n\n  // Compute glue ratio R_g = fast_glue / max(1, slow_glue)\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double glue_ratio = fast_glue / (slow_glue < 1.0 ? 1.0 : slow_glue);\n\n  // Retrieve decision rate and baseline\n  const double decision_rate = AVERAGE (decision_rate);\n  double baseline = solver->decision_rate_baseline;\n\n  // On first call, initialize baseline if not set (0 is invalid, so use current value)\n  if (baseline <= 0.0)\n    baseline = solver->decision_rate_baseline = decision_rate;\n\n  // Compute decision rate drop R_d = decision_rate / baseline\n  const double decision_rate_drop = baseline > 0.0 ? (decision_rate / baseline) : 1.0;\n\n  // Thresholds\n  const double glue_ratio_threshold = 1.2;\n  const double decision_rate_drop_threshold = 0.7;\n\n  // Restart triggers\n  const bool glue_ratio_trigger = glue_ratio > glue_ratio_threshold;\n  const bool decision_rate_trigger = decision_rate_drop < decision_rate_drop_threshold;\n\n  bool restart = false;\n  char reason = '-';\n\n  if (!solver->stable)\n  {\n    // In non-stable stage: restart if either trigger is met\n    if (glue_ratio_trigger || decision_rate_trigger)\n    {\n      restart = true;\n      reason = glue_ratio_trigger ? 'G' : 'D';\n    }\n  }\n  else\n  {\n    // In stable stage: restart only if both triggers are met\n    if (glue_ratio_trigger && decision_rate_trigger)\n    {\n      restart = true;\n      reason = 'B'; // Both\n    }\n  }\n\n  if (restart)\n  {\n    // After each restart, reset baseline to current decision rate\n    solver->decision_rate_baseline = decision_rate;\n    kissat_extremely_verbose (\n      solver,\n      \"AGDHR restart: glue_ratio=%.3f (fast=%.3f, slow=%.3f, thr=%.2f), decision_rate_drop=%.3f (rate=%.3f, baseline=%.3f, thr=%.2f), stable=%d, triggered=%c\",\n      glue_ratio, fast_glue, slow_glue, glue_ratio_threshold,\n      decision_rate_drop, decision_rate, baseline, decision_rate_drop_threshold,\n      solver->stable, reason);\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 688, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2135}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e63944ec81908c17bbff065b8549", "custom_id": "req-0002", "response": {"status_code": 200, "request_id": "2937b678e2781c49e5433806ac0e7b73", "body": {"id": "resp_04e5cd8fbde1c90a006921e5bab0408194a7c3bd365237470f", "object": "response", "created_at": 1763829178, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_04e5cd8fbde1c90a006921e5bb17f881949e915c82c1a77d05", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Hard limit: always restart if conflicts exceed limit\n  if (CONFLICTS >= solver->limits.restart.conflicts) {\n    // Reset decision_rate_baseline after restart\n    solver->decision_rate_baseline = solver->averages[solver->stable].decision_rate.value;\n    kissat_extremely_verbose (\n      solver,\n      \"hard restart: conflicts %\" PRIu64 \" >= limit %\" PRIu64,\n      CONFLICTS, solver->limits.restart.conflicts\n    );\n    return true;\n  }\n\n  // Read averages\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // Compute glue ratio R_g\n  const double glue_ratio = fast_glue / (slow_glue > 1e-9 ? slow_glue : 1.0);\n\n  // Baseline decision rate: if not initialized, set to current\n  if (solver->decision_rate_baseline <= 0.0)\n    solver->decision_rate_baseline = decision_rate;\n\n  // Compute decision rate drop R_d\n  const double decision_rate_drop = decision_rate / (solver->decision_rate_baseline > 1e-9 ? solver->decision_rate_baseline : 1.0);\n\n  // Thresholds\n  const double GLUE_RATIO_THRESHOLD = 1.2;\n  const double DECISION_RATE_DROP_THRESHOLD = 0.7;\n\n  bool trigger_glue = glue_ratio > GLUE_RATIO_THRESHOLD;\n  bool trigger_decision = decision_rate_drop < DECISION_RATE_DROP_THRESHOLD;\n\n  bool restart = false;\n\n  if (!solver->stable) {\n    // In non-stable: restart if either is triggered\n    restart = trigger_glue || trigger_decision;\n  } else {\n    // In stable: restart only if both are triggered\n    restart = trigger_glue && trigger_decision;\n  }\n\n  if (restart) {\n    // Tie-breaker: glue ratio is primary reason if both, else whichever\n    if (trigger_glue && trigger_decision)\n      kissat_extremely_verbose (\n        solver,\n        \"restart triggered (hybrid): glue ratio %.2f > %.2f and decision rate drop %.2f < %.2f [stable=%d]\",\n        glue_ratio, GLUE_RATIO_THRESHOLD, decision_rate_drop, DECISION_RATE_DROP_THRESHOLD, solver->stable\n      );\n    else if (trigger_glue)\n      kissat_extremely_verbose (\n        solver,\n        \"restart triggered: glue ratio %.2f > %.2f [stable=%d]\",\n        glue_ratio, GLUE_RATIO_THRESHOLD, solver->stable\n      );\n    else\n      kissat_extremely_verbose (\n        solver,\n        \"restart triggered: decision rate drop %.2f < %.2f [stable=%d]\",\n        decision_rate_drop, DECISION_RATE_DROP_THRESHOLD, solver->stable\n      );\n\n    // Reset decision_rate_baseline after each restart\n    solver->decision_rate_baseline = decision_rate;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 694, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2141}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e63946988190bc3ff6b81f95ca1c", "custom_id": "req-0003", "response": {"status_code": 200, "request_id": "c9ca13fb873d9579db14cf85456ba172", "body": {"id": "resp_0401f8dbc8194eb6006921e5c01c408197a7c8f87bb6e50ff1", "object": "response", "created_at": 1763829184, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0401f8dbc8194eb6006921e5c05e34819781a0d8e3ec3a7d7c", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Hard limit: always restart if conflict limit reached.\n  if (CONFLICTS >= solver->limits.restart.conflicts) {\n    // Reset decision_rate_baseline after restart\n    solver->decision_rate_baseline = solver->averages[solver->stable].decision_rate.value;\n    kissat_extremely_verbose(solver,\n      \"hard conflict limit reached (%\" PRIu64 \" >= %\" PRIu64 \"), forcing restart\",\n      CONFLICTS, solver->limits.restart.conflicts);\n    return true;\n  }\n\n  const double fast_glue = solver->averages[solver->stable].fast_glue.value;\n  const double slow_glue = solver->averages[solver->stable].slow_glue.value;\n  const double decision_rate = solver->averages[solver->stable].decision_rate.value;\n\n  // Defensive: avoid division by zero\n  const double denom_slow = slow_glue > 1e-9 ? slow_glue : 1.0;\n  const double glue_ratio = fast_glue / denom_slow;\n\n  // Update baseline every 100 conflicts (window size 1000, update step 100)\n  // Assumes solver->decision_rate_baseline is initialized to decision rate at startup\n  if ((CONFLICTS % 100) == 0) {\n    if (decision_rate > solver->decision_rate_baseline)\n      solver->decision_rate_baseline = decision_rate;\n  }\n  const double baseline = solver->decision_rate_baseline > 1e-9 ? solver->decision_rate_baseline : 1.0;\n  const double decision_rate_drop = decision_rate / baseline;\n\n  // Thresholds\n  const double glue_ratio_threshold = 1.2;\n  const double decision_rate_drop_threshold = 0.7;\n\n  // Triggers\n  bool glue_ratio_trigger = (glue_ratio > glue_ratio_threshold);\n  bool decision_rate_drop_trigger = (decision_rate_drop < decision_rate_drop_threshold);\n\n  bool restart = false;\n  const char *reason = 0;\n\n  if (!solver->stable) {\n    // Aggressive in unstable phase: OR\n    if (glue_ratio_trigger) {\n      restart = true;\n      reason = \"glue-ratio\";\n    }\n    else if (decision_rate_drop_trigger) {\n      restart = true;\n      reason = \"decision-rate-drop\";\n    }\n  } else {\n    // Conservative in stable phase: AND\n    if (glue_ratio_trigger && decision_rate_drop_trigger) {\n      restart = true;\n      reason = \"glue-ratio+decision-rate-drop\";\n    }\n  }\n\n  if (restart) {\n    // Reset baseline on restart\n    solver->decision_rate_baseline = decision_rate;\n    kissat_extremely_verbose(solver,\n      \"adaptive hybrid restart: \"\n      \"glue_ratio=%.3f (fast=%.3f, slow=%.3f, threshold=%.2f) \"\n      \"decision_rate_drop=%.3f (current=%.3f, baseline=%.3f, threshold=%.2f) \"\n      \"stage=%s, reason=%s\",\n      glue_ratio, fast_glue, slow_glue, glue_ratio_threshold,\n      decision_rate_drop, decision_rate, baseline, decision_rate_drop_threshold,\n      solver->stable ? \"stable\" : \"unstable\", reason ? reason : \"unknown\");\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 756, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2203}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e63937808190a7d5d5d77c00124e", "custom_id": "req-0004", "response": {"status_code": 200, "request_id": "b1440cc890d0711125769b2aa05fb14c", "body": {"id": "resp_0610e80163dd98f1006921e5c66dfc8197b58c92e08b7dc6df", "object": "response", "created_at": 1763829190, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0610e80163dd98f1006921e5c6b2e881979a7f8c5fbc53dc2b", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Hard limit: always restart if conflict limit reached\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Gather averages\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // Compute glue ratio\n  const double glue_ratio = fast_glue / (slow_glue > 1e-12 ? slow_glue : 1.0);\n\n  // --- Maintain and access decision_rate_baseline ---\n  // Store baseline in solver->restart_decision_rate_baseline (double)\n  double *baseline_ptr = &solver->restart_decision_rate_baseline;\n  double baseline = *baseline_ptr;\n\n  // If first call, or after reset, set baseline to current\n  if (baseline < 1e-12)\n    baseline = decision_rate;\n\n  // Compute decision rate drop ratio\n  const double decision_rate_drop = (baseline > 1e-12) ? (decision_rate / baseline) : 1.0;\n\n  // --- Update baseline every 100 conflicts (approx) ---\n  // Use solver->statistics.conflicts as conflict count\n  if (solver->statistics.conflicts % 100 == 0)\n  {\n    if (decision_rate > baseline)\n      baseline = decision_rate; // track max in last 1000\n  }\n  // Decay baseline every 1000 conflicts to avoid stale max\n  if (solver->statistics.conflicts % 1000 == 0)\n  {\n    baseline = decision_rate > baseline ? decision_rate : baseline;\n  }\n\n  *baseline_ptr = baseline;\n\n  // Thresholds\n  const double glue_ratio_threshold = 1.2;\n  const double decision_rate_drop_threshold = 0.7;\n\n  int restart_reason = 0; // 1 = glue, 2 = decision rate, 3 = both\n\n  // Non-stable: restart if (R_g > T_g) OR (R_d < T_d)\n  if (!solver->stable)\n  {\n    if (glue_ratio > glue_ratio_threshold && decision_rate_drop < decision_rate_drop_threshold)\n      restart_reason = 3;\n    else if (glue_ratio > glue_ratio_threshold)\n      restart_reason = 1;\n    else if (decision_rate_drop < decision_rate_drop_threshold)\n      restart_reason = 2;\n  }\n  // Stable: restart if (R_g > T_g) AND (R_d < T_d)\n  else\n  {\n    if (glue_ratio > glue_ratio_threshold && decision_rate_drop < decision_rate_drop_threshold)\n      restart_reason = 3;\n  }\n\n  // Logging for tie-breaker\n  if (restart_reason == 1)\n    kissat_extremely_verbose (solver,\n      \"AGDHR restart (non-stable) due to glue ratio: fast %.2f, slow %.2f, ratio %.2f > threshold %.2f\",\n      fast_glue, slow_glue, glue_ratio, glue_ratio_threshold);\n  else if (restart_reason == 2)\n    kissat_extremely_verbose (solver,\n      \"AGDHR restart (non-stable) due to decision rate drop: rate %.2f, baseline %.2f, drop %.2f < threshold %.2f\",\n      decision_rate, baseline, decision_rate_drop, decision_rate_drop_threshold);\n  else if (restart_reason == 3)\n    kissat_extremely_verbose (solver,\n      \"AGDHR restart due to both triggers: glue ratio %.2f, decision rate drop %.2f\", glue_ratio, decision_rate_drop);\n\n  if (restart_reason)\n  {\n    // Reset baseline after restart\n    *baseline_ptr = decision_rate;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 849, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2296}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e6394bb48190bed600e4ad2b4a0f", "custom_id": "req-0005", "response": {"status_code": 200, "request_id": "0008b3f2cdbb8ac2db47b78ed5798a74", "body": {"id": "resp_0ec0d199fae31372006921e5cd6d888190ac583a51a1649c9b", "object": "response", "created_at": 1763829197, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0ec0d199fae31372006921e5ceae608190a5f9cf1d0194af71", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting(kissat *solver)\n{\n    assert(solver->unassigned);\n    if (!GET_OPTION(restart))\n        return false;\n    if (!solver->level)\n        return false;\n\n    // Hard limit (always applies)\n    if (CONFLICTS >= solver->limits.restart.conflicts) {\n        solver->decision_rate_baseline = solver->averages[solver->stable].decision_rate.value;\n        kissat_extremely_verbose(solver,\n            \"restart: hard conflict limit reached (%\" PRIu64 \" >= %\" PRIu64 \")\",\n            CONFLICTS, solver->limits.restart.conflicts);\n        return true;\n    }\n\n    const bool stable = solver->stable;\n\n    // Glue ratio R_g = fast_glue / max(1, slow_glue)\n    const double fast = AVERAGE(fast_glue);\n    const double slow = AVERAGE(slow_glue);\n    const double glue_ratio = fast / (slow > 1.0 ? slow : 1.0);\n\n    // Decision rate and baseline\n    const double decision_rate = AVERAGE(decision_rate);\n    double baseline = solver->decision_rate_baseline;\n    if (baseline < 1e-12) // Uninitialized or tiny: set to current rate\n        baseline = decision_rate > 1e-12 ? decision_rate : 1.0;\n\n    const double decision_rate_drop = decision_rate / baseline;\n\n    // Thresholds\n    const double T_g = 1.2;\n    const double T_d = 0.7;\n\n    // Triggers\n    bool reason_glue = false, reason_decision = false, triggered = false;\n\n    if (!stable) {\n        // aggressive: restart if EITHER signal triggers\n        if (glue_ratio > T_g) { reason_glue = true; triggered = true; }\n        if (decision_rate_drop < T_d) { reason_decision = true; triggered = true; }\n    } else {\n        // conservative: restart only if BOTH triggers\n        if (glue_ratio > T_g && decision_rate_drop < T_d) {\n            reason_glue = true;\n            reason_decision = true;\n            triggered = true;\n        }\n    }\n\n    if (triggered) {\n        solver->decision_rate_baseline = decision_rate;\n        kissat_extremely_verbose(solver,\n            \"restart: %s%s%s glue_ratio=%.4f (T_g=%.2f), decision_rate_drop=%.4f (T_d=%.2f), baseline=%.4f, current=%.4f\",\n            reason_glue ? \"glue\" : \"\",\n            (reason_glue && reason_decision) ? \"+\" : \"\",\n            reason_decision ? \"decision\" : \"\",\n            glue_ratio, T_g, decision_rate_drop, T_d, baseline, decision_rate);\n        return true;\n    }\n\n    // Periodically update the baseline to the max in window (every 100 conflicts)\n    // This is a simple implementation: update if new max observed\n    static const uint64_t window = 1000, period = 100;\n    if (!solver->decision_rate_baseline_window_conflicts)\n        solver->decision_rate_baseline_window_conflicts = CONFLICTS;\n    if (!solver->decision_rate_baseline_window_max)\n        solver->decision_rate_baseline_window_max = decision_rate;\n\n    if (decision_rate > solver->decision_rate_baseline_window_max)\n        solver->decision_rate_baseline_window_max = decision_rate;\n\n    if (CONFLICTS - solver->decision_rate_baseline_window_conflicts >= period) {\n        if (solver->decision_rate_baseline < solver->decision_rate_baseline_window_max)\n            solver->decision_rate_baseline = solver->decision_rate_baseline_window_max;\n        solver->decision_rate_baseline_window_conflicts = CONFLICTS;\n        solver->decision_rate_baseline_window_max = decision_rate;\n    }\n\n    return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 826, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2273}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e6394ac88190976baa53c9565b99", "custom_id": "req-0006", "response": {"status_code": 200, "request_id": "b621ca994e189b7a66e5599b68361a30", "body": {"id": "resp_06dfd002468fbe2b006921e5d5733481909109d71fcad1a07c", "object": "response", "created_at": 1763829205, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_06dfd002468fbe2b006921e5d5bd3481909a2a6db3384ec178", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n\n  if (!solver->level)\n    return false;\n\n  // Hard limit: always restart if conflicts >= limit\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // === AGDHR Algorithm Implementation ===\n\n  // -- Compute fast/slow glue ratio --\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double glue_ratio = fast_glue / (slow_glue > 1e-6 ? slow_glue : 1.0);\n\n  // -- Compute decision rate drop --\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // Decision rate baseline: maintain max observed in last window\n  // We use a moving window in solver->restarting_decision_rate_baseline, updated every 100 conflicts\n  // If not initialized, initialize it to current decision rate\n  if (solver->restarting_decision_rate_baseline < 1e-12)\n    solver->restarting_decision_rate_baseline = decision_rate;\n\n  // Update baseline every 100 conflicts to the max of baseline and current\n  if (((CONFLICTS % 100) == 0) && CONFLICTS)\n    {\n      if (decision_rate > solver->restarting_decision_rate_baseline)\n        solver->restarting_decision_rate_baseline = decision_rate;\n    }\n\n  const double decision_rate_baseline =\n    solver->restarting_decision_rate_baseline > 1e-12\n      ? solver->restarting_decision_rate_baseline\n      : 1.0;\n\n  const double rate_ratio = decision_rate / decision_rate_baseline;\n\n  // -- Thresholds --\n  const double glue_threshold = 1.2;\n  const double rate_threshold = 0.7;\n\n  bool glue_trigger = glue_ratio > glue_threshold;\n  bool rate_trigger = rate_ratio < rate_threshold;\n\n  bool triggered = false;\n  const char *reason = 0;\n\n  if (solver->stable)\n    {\n      // In stable stage: BOTH triggers must be met\n      if (glue_trigger && rate_trigger)\n        {\n          triggered = true;\n          reason = \"both glue and decision rate triggers (stable)\";\n        }\n    }\n  else\n    {\n      // In non-stable stage: Either trigger is enough\n      if (glue_trigger)\n        {\n          triggered = true;\n          reason = \"glue trigger (non-stable)\";\n        }\n      else if (rate_trigger)\n        {\n          triggered = true;\n          reason = \"decision rate trigger (non-stable)\";\n        }\n    }\n\n  if (triggered)\n    {\n      kissat_extremely_verbose (solver,\n        \"AGDHR restart: %s [glue_ratio=%.3f, fast=%.2f, slow=%.2f | rate_ratio=%.3f, rate=%.2f, baseline=%.2f]\",\n        reason, glue_ratio, fast_glue, slow_glue, rate_ratio, decision_rate, decision_rate_baseline);\n\n      // After each restart, reset decision_rate_baseline to current\n      solver->restarting_decision_rate_baseline = decision_rate;\n\n      return true;\n    }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 717, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2164}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e6394b2481908d15186122902d8f", "custom_id": "req-0007", "response": {"status_code": 200, "request_id": "9fb23f4cdaed7ba188d9e617635770d2", "body": {"id": "resp_0fe23d9a7afaf5a1006921e5db5c888193825e481bd0f3f2bc", "object": "response", "created_at": 1763829211, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0fe23d9a7afaf5a1006921e5dbd9348193b37082e4529de749", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Hard restart limit\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n  {\n    kissat_extremely_verbose (solver,\n      \"restart: reached hard conflict limit %\" PRIu64 \" >= %\" PRIu64,\n      CONFLICTS, solver->limits.restart.conflicts);\n    // AGDHR: reset decision_rate_baseline upon restart\n    solver->decision_rate_baseline = AVERAGE (decision_rate);\n    return true;\n  }\n\n  // --- Adaptive Glue-Decision Hybrid Restart (AGDHR) ---\n\n  // 1. Compute glue ratio and decision rate drop\n  const double fast = AVERAGE (fast_glue);\n  const double slow = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // Baseline: maintain max decision rate over a sliding window (here: simple max)\n  // We approximate by always updating with max of current or previous baseline\n  if (decision_rate > solver->decision_rate_baseline)\n    solver->decision_rate_baseline = decision_rate;\n\n  const double glue_ratio = fast / (slow > 1e-9 ? slow : 1.0); // guard slow > 0\n  const double decision_rate_drop = (solver->decision_rate_baseline > 1e-9)\n    ? (decision_rate / solver->decision_rate_baseline)\n    : 1.0;\n\n  // 2. Thresholds\n  const double GLUE_RATIO_THRESHOLD = 1.2;\n  const double DECISION_DROP_THRESHOLD = 0.7;\n\n  // 3. Restart trigger logic\n  bool glue_reason = false, decision_reason = false, restart = false;\n\n  if (solver->stable)\n  {\n    // Stable: conservative: require both\n    if (glue_ratio > GLUE_RATIO_THRESHOLD && decision_rate_drop < DECISION_DROP_THRESHOLD)\n    {\n      restart = true;\n      glue_reason = true;\n      decision_reason = true;\n    }\n  }\n  else\n  {\n    // Unstable: aggressive: either\n    if (glue_ratio > GLUE_RATIO_THRESHOLD)\n    {\n      restart = true;\n      glue_reason = true;\n    }\n    if (decision_rate_drop < DECISION_DROP_THRESHOLD)\n    {\n      restart = true;\n      decision_reason = true;\n    }\n  }\n\n  if (restart)\n  {\n    // AGDHR: Tie-breaker: prefer glue reason in stats/log\n    if (glue_reason)\n      kissat_extremely_verbose (solver,\n        \"restart: AGDHR (glue ratio %.2f > %.2f%s%s, fast %.2f, slow %.2f)\",\n        glue_ratio, GLUE_RATIO_THRESHOLD,\n        decision_reason ? \", decision rate drop\" : \"\",\n        solver->stable ? \", stable\" : \"\",\n        fast, slow);\n    else\n      kissat_extremely_verbose (solver,\n        \"restart: AGDHR (decision rate drop %.2f < %.2f%s, curr %.2f, baseline %.2f)\",\n        decision_rate_drop, DECISION_DROP_THRESHOLD,\n        solver->stable ? \", stable\" : \"\",\n        decision_rate, solver->decision_rate_baseline);\n\n    // After restart, reset baseline\n    solver->decision_rate_baseline = decision_rate;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 745, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2192}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e63945888190bcefeeba35f30f86", "custom_id": "req-0008", "response": {"status_code": 200, "request_id": "a71296514b0e78f132cbd1f1e5d81c2a", "body": {"id": "resp_00bdcf1f7f00e1b2006921e5e231e48195b976587ee80dcf34", "object": "response", "created_at": 1763829218, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_00bdcf1f7f00e1b2006921e5e2f6108195a11449b755c4939e", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver) {\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Hard conflict limit: always allow restart if at/above limit\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Compute fast and slow glue averages for glue ratio\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double glue_ratio = fast_glue / (slow_glue > 1.0 ? slow_glue : 1.0);\n\n  // Compute decision rate\n  const double decision_rate = solver->averages[solver->stable].decision_rate.value;\n\n  // Decision rate baseline: store in solver->restart_decision_rate_baseline (must be defined in solver struct)\n  // If not available, declare static double here (for code example):\n  static double decision_rate_baseline = 0.0;\n  static uint64_t last_baseline_update_conflicts = 0;\n\n  // Update baseline every 100 conflicts, track max over last 1000 conflicts\n  if (decision_rate > decision_rate_baseline) {\n    decision_rate_baseline = decision_rate;\n    last_baseline_update_conflicts = CONFLICTS;\n  } else if (CONFLICTS - last_baseline_update_conflicts >= 1000) {\n    // After 1000 conflicts, reset baseline to current rate\n    decision_rate_baseline = decision_rate;\n    last_baseline_update_conflicts = CONFLICTS;\n  }\n\n  double decision_rate_drop = decision_rate_baseline > 0.0 ? decision_rate / decision_rate_baseline : 1.0;\n\n  // Thresholds\n  const double GLUE_RATIO_THRESHOLD = 1.2;\n  const double DECISION_RATE_DROP_THRESHOLD = 0.7;\n\n  bool glue_trigger = glue_ratio > GLUE_RATIO_THRESHOLD;\n  bool decision_trigger = decision_rate_drop < DECISION_RATE_DROP_THRESHOLD;\n  bool restart = false;\n\n  if (solver->stable) {\n    // Stable: conservative (AND)\n    restart = glue_trigger && decision_trigger;\n  } else {\n    // Unstable: aggressive (OR)\n    restart = glue_trigger || decision_trigger;\n  }\n\n  if (restart) {\n    // Tie-breaker: prefer glue for logging/statistics if both fire\n    if (glue_trigger && decision_trigger)\n      kissat_extremely_verbose (solver,\n        \"restarting: both triggers met (primary glue): glue_ratio %.2f > %.2f, decision_drop %.2f < %.2f\",\n        glue_ratio, GLUE_RATIO_THRESHOLD, decision_rate_drop, DECISION_RATE_DROP_THRESHOLD);\n    else if (glue_trigger)\n      kissat_extremely_verbose (solver,\n        \"restarting: glue trigger: glue_ratio %.2f > %.2f\",\n        glue_ratio, GLUE_RATIO_THRESHOLD);\n    else\n      kissat_extremely_verbose (solver,\n        \"restarting: decision rate drop trigger: decision_drop %.2f < %.2f\",\n        decision_rate_drop, DECISION_RATE_DROP_THRESHOLD);\n\n    // After restart, reset baseline to current\n    decision_rate_baseline = decision_rate;\n    last_baseline_update_conflicts = CONFLICTS;\n    return true;\n  }\n\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 720, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2167}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e639487c8190933d6cfa9d754e3c", "custom_id": "req-0009", "response": {"status_code": 200, "request_id": "02574977aec84530cde899ed1aaa98ff", "body": {"id": "resp_0bd0e8fa6c1395ad006921e5e8813c8197aed79f376a128ddc", "object": "response", "created_at": 1763829224, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0bd0e8fa6c1395ad006921e5e903648197853cccdda81b3037", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Hard conflict limit: always restart if needed\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Fetch averages\n  const double fast = AVERAGE (fast_glue);\n  const double slow = AVERAGE (slow_glue);\n  // Avoid division by zero in glue ratio\n  const double glue_ratio = fast / (slow > 1e-12 ? slow : 1.0);\n\n  // Decision rate\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // --- Adaptive baseline for decision rate ---\n  // We keep the maximum decision rate in last 1000 conflicts (updated every 100 conflicts)\n  // We'll use solver->restart_decision_rate_baseline to store the baseline.\n  // We'll use solver->restart_last_baseline_update to store the last update conflict count.\n\n  // Initialize if necessary\n  if (solver->restart_decision_rate_baseline < 1e-12)\n    solver->restart_decision_rate_baseline = decision_rate;\n\n  // Update baseline every 100 conflicts over a 1000-conflict window\n  if (CONFLICTS - solver->restart_last_baseline_update >= 100)\n  {\n    if (decision_rate > solver->restart_decision_rate_baseline)\n      solver->restart_decision_rate_baseline = decision_rate;\n    solver->restart_last_baseline_update = CONFLICTS;\n    // Optionally, you could decay the baseline to avoid being too sticky,\n    // but for now we keep max in the window.\n  }\n  const double baseline = solver->restart_decision_rate_baseline;\n  const double decision_rate_drop = baseline > 1e-12 ? decision_rate / baseline : 1.0;\n\n  // Thresholds\n  const double glue_ratio_threshold = 1.2;\n  const double decision_rate_drop_threshold = 0.7;\n\n  bool glue_trigger = (glue_ratio > glue_ratio_threshold);\n  bool decision_rate_trigger = (decision_rate_drop < decision_rate_drop_threshold);\n  bool restart = false;\n\n  if (!solver->stable)\n  {\n    // Non-stable: restart if either trigger\n    restart = glue_trigger || decision_rate_trigger;\n  }\n  else\n  {\n    // Stable: restart only if both triggers\n    restart = glue_trigger && decision_rate_trigger;\n  }\n\n  if (restart)\n  {\n    // Tie-breaker: prefer glue for log if both\n    const char *reason =\n      glue_trigger ? (decision_rate_trigger ? \"glue+decision\" : \"glue\") : \"decision\";\n    kissat_extremely_verbose (solver,\n      \"adaptive glue-decision restart: glue_ratio=%.3f (%.3f/%.3f) [thr=%.2f], \"\n      \"decision_rate_drop=%.3f (%.3f/%.3f) [thr=%.2f], \"\n      \"stage=%s, trigger=%s\",\n      glue_ratio, fast, slow, glue_ratio_threshold,\n      decision_rate_drop, decision_rate, baseline, decision_rate_drop_threshold,\n      solver->stable ? \"stable\" : \"focused\", reason);\n\n    // After restart, reset baseline to current rate\n    solver->restart_decision_rate_baseline = decision_rate;\n    solver->restart_last_baseline_update = CONFLICTS;\n    return true;\n  }\n\n  // No trigger: do not restart\n  return false;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 761, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2208}, "user": null, "metadata": {}}}, "error": null}
{"id": "batch_req_6921e63944208190afd3fdf39d0744f3", "custom_id": "req-0010", "response": {"status_code": 200, "request_id": "fcae2a88d4d23876e1a96f91a291f16e", "body": {"id": "resp_0adc657c2a7cdc2e006921e5f0926c8190981153c0ec712899", "object": "response", "created_at": 1763829232, "status": "completed", "background": false, "billing": {"payer": "developer"}, "error": null, "incomplete_details": null, "instructions": null, "max_output_tokens": null, "max_tool_calls": null, "model": "gpt-4.1-2025-04-14", "output": [{"id": "msg_0adc657c2a7cdc2e006921e5f0f8cc81909f88a04bfa153d29", "type": "message", "status": "completed", "content": [{"type": "output_text", "annotations": [], "logprobs": [], "text": "<code>\nbool kissat_restarting (kissat *solver)\n{\n  assert (solver->unassigned);\n\n  if (!GET_OPTION (restart))\n    return false;\n  if (!solver->level)\n    return false;\n\n  // Hard limit: always restart if conflict count exceeds limit\n  if (CONFLICTS >= solver->limits.restart.conflicts)\n    return true;\n\n  // Get current averages\n  const double fast_glue = AVERAGE (fast_glue);\n  const double slow_glue = AVERAGE (slow_glue);\n  const double decision_rate = AVERAGE (decision_rate);\n\n  // Baseline for decision rate: maximum in last N conflicts (N=1000), updated every 100 conflicts\n  // For simplicity and portability, we store baseline in solver->restart_decision_rate_baseline (add this to solver struct)\n  // On first call, initialize if zero\n  if (!solver->restart_decision_rate_baseline)\n    solver->restart_decision_rate_baseline = decision_rate;\n\n  // Update baseline every 100 conflicts\n  if ((CONFLICTS % 100) == 0)\n    if (decision_rate > solver->restart_decision_rate_baseline)\n      solver->restart_decision_rate_baseline = decision_rate;\n\n  // Compute ratios\n  const double glue_ratio = fast_glue / (slow_glue > 1e-9 ? slow_glue : 1.0);\n\n  const double decision_rate_baseline = solver->restart_decision_rate_baseline > 1e-9 ? solver->restart_decision_rate_baseline : 1.0;\n  const double decision_rate_ratio = decision_rate / decision_rate_baseline;\n\n  // Thresholds\n  const double GLUE_RATIO_THRESHOLD = 1.2;\n  const double DECISION_RATE_DROP_THRESHOLD = 0.7;\n\n  // Restart policy\n  bool restart = false;\n  bool glue_trigger = (glue_ratio > GLUE_RATIO_THRESHOLD);\n  bool drate_trigger = (decision_rate_ratio < DECISION_RATE_DROP_THRESHOLD);\n\n  if (!solver->stable)\n    restart = glue_trigger || drate_trigger;\n  else\n    restart = glue_trigger && drate_trigger;\n\n  // Tie-breaker (for logging)\n  if (restart) {\n    const char *reason = \"unknown\";\n    if (glue_trigger && drate_trigger)\n      reason = \"glue and drate\";\n    else if (glue_trigger)\n      reason = \"glue\";\n    else if (drate_trigger)\n      reason = \"drate\";\n    kissat_extremely_verbose (\n      solver,\n      \"adaptive glue-decision restart: \"\n      \"fast_glue=%.2f slow_glue=%.2f glue_ratio=%.3f decision_rate=%.2f baseline=%.2f drate_ratio=%.3f reason=%s\",\n      fast_glue, slow_glue, glue_ratio,\n      decision_rate, decision_rate_baseline, decision_rate_ratio,\n      reason);\n    // After restart: reset baseline\n    solver->restart_decision_rate_baseline = decision_rate;\n  }\n\n  return restart;\n}\n</code>"}], "role": "assistant"}], "parallel_tool_calls": true, "previous_response_id": null, "prompt_cache_key": null, "prompt_cache_retention": null, "reasoning": {"effort": null, "summary": null}, "safety_identifier": null, "service_tier": "default", "store": true, "temperature": 0.7, "text": {"format": {"type": "text"}, "verbosity": "medium"}, "tool_choice": "auto", "tools": [], "top_logprobs": 0, "top_p": 1.0, "truncation": "disabled", "usage": {"input_tokens": 1447, "input_tokens_details": {"cached_tokens": 0}, "output_tokens": 653, "output_tokens_details": {"reasoning_tokens": 0}, "total_tokens": 2100}, "user": null, "metadata": {}}}, "error": null}
